"use strict";var parking=angular.module("parking",["ui.router","common.module","login.module","ngCookies","ngDialog"]).config(["$urlRouterProvider","$stateProvider",function(t,o){t.otherwise("/"),o.state("home",{templateUrl:"views/home/home.html",url:"/"})}]),common=angular.module("common.module",[]);common.directive("parkingCounter",function(){return{restrict:"E",templateUrl:"views/common/parking-counter.html",controller:"parkingCounterCtrl",controllerAs:"counter",replace:!0}}),common.directive("tableFilter",function(){return{restrict:"E",templateUrl:"views/common/table-filter.html",controller:"tableFilterCtrl",controllerAs:"filter",replace:!0}}),common.controller("addNewModal",["$scope","$log","$timeout","SlotsFactory","ngDialog",function(t,o,e,n,r){var i;this.spots=n.spots,t.saveNew=angular.bind(this,function(){i={name:t.name,plate:t.plate,type:t.type},n.createUser(i),r.closeAll()})}]),common.controller("tableFilterCtrl",function(){}),common.service("SpotsService",["$http","$q",function(){}]),common.factory("SlotsFactory",["$http","$q","$log","$timeout",function(t,o,e){var n={},r="/spots",i=0;return n.spots=[],n.init=function(){this.getData(r).then(angular.bind(this,function(t){for(var o in t)t[o].plate=n.normalizePlate(t[o].plate);n.spots=t,n.setAvailableSlots()}))},n.setAvailableSlots=function(){for(var t=n.spots.length,o=0,e=0;t>e;e++)o+=n.spots[e].active?1:0;10>=o&&(i=o)},n.getAvailableSlots=function(){return i},n.assignSlot=function(t){var o;t=n.normalizePlate(t);for(var e=0;e<n.spots.length;e++)o=n.normalizePlate(n.spots[e].plate),t==o&&(n.spots[e].active=n.spots[e].active?!1:!0,n.setAvailableSlots())},n.normalizePlate=function(t){return t.match(/[A-Za-z0-9]/gi).join("").toUpperCase()},n.createUser=function(t){if("object"!=typeof n.searchPlate(t.plate)){var o={active:!1,type:t.type.toLowerCase(),plate:n.normalizePlate(t.plate),name:t.name};n.spots.push(o)}},n.searchPlate=function(t){t=n.normalizePlate(t);for(var o in n.spots){var r=n.normalizePlate(n.spots[o].plate);if(e.info(r,t),r===t)return{position:o}}return!1},n.getData=function(){var e=o.defer();return t.get(r).success(function(t){e.resolve(t)}).error(function(){e.reject()}),e.promise},n}]),common.directive("parkingSlot",function(){return{restrict:"E",templateUrl:"views/common/parking-slot.html",controller:"parkingSlotCtrl",controllerAs:"slots",replace:!0}}),common.controller("parkingSlotCtrl",["SpotsService","SlotsFactory","$log","$scope",function(t,o,e,n){this.spots={},o.init(),n.$watch(function(){return o.spots},angular.bind(this,function(t){this.spots=t})),this.assignSlot=function(t){o.assignSlot(t),this.spots=o.spots}}]),common.controller("addNewCtrl",["$scope","$log","ngDialog","SlotsFactory",function(t,o,e){t.addNew=function(){e.open({template:"views/common/new-vehicle-modal.html",className:"modal-container",controller:"addNewModal"})}}]),common.controller("parkingCounterCtrl",["SlotsFactory","$scope",function(t,o){this.available=t.getAvailableSlots(),o.$watch(t.getAvailableSlots,angular.bind(this,function(t){this.available=t}))}]),common.directive("newVehicle",function(){return{restrict:"E",templateUrl:"views/common/new-vehicle.html",controller:"addNewCtrl",controllerAs:"new",replace:!0}}),common.factory("SlotsFactory",["$http","$q","$log","$timeout",function(t,o,e){var n={},r="/spots",i=0;return n.spots=[],n.init=function(){this.getData(r).then(angular.bind(this,function(t){for(var o in t)t[o].plate=n.normalizePlate(t[o].plate);n.spots=t,n.setAvailableSlots()}))},n.setAvailableSlots=function(){for(var t=n.spots.length,o=0,e=0;t>e;e++)o+=n.spots[e].active?1:0;i=o},n.getAvailableSlots=function(){return i},n.assignSlot=function(t){var o;t=n.normalizePlate(t);for(var e=0;e<n.spots.length;e++)o=n.normalizePlate(n.spots[e].plate),t==o&&(n.spots[e].active=n.spots[e].active?!1:!0,n.setAvailableSlots())},n.normalizePlate=function(t){return t.match(/[A-Za-z0-9]/gi).join("").toUpperCase()},n.createUser=function(t){if("object"!=typeof n.searchPlate(t.plate)){var o={active:!1,type:t.type.toLowerCase(),plate:n.normalizePlate(t.plate),name:t.name};n.spots.push(o)}},n.searchPlate=function(t){t=n.normalizePlate(t);for(var o in n.spots){var r=n.normalizePlate(n.spots[o].plate);if(e.info(r,t),r===t)return{position:o}}return!1},n.getData=function(){var e=o.defer();return t.get(r).success(function(t){e.resolve(t)}).error(function(){e.reject()}),e.promise},n}]);var login=angular.module("login.module",["ngCookies"]);login.config(["$stateProvider",function(t){t.state("login",{controllerAs:"login",controller:"loginCtrl",templateUrl:"views/login/login.html",url:"/login"})}]),login.service("LoginService",["$state","$cookieStore",function(t,o){this.login=function(){return o.put("session","parking user session"),!0},this.isLogged=function(){var t=o.get("session");return t?!0:!1},this.logout=function(){var e=!0;e?(o.remove("session"),t.go("home")):$log.error("The user doesn't wanna go...")}}]),login.controller("loginCtrl",["$state","LoginService",function(t,o){this.user={},this.methods={},this.errors={},this.errors.login=!1,this.methods.submit=angular.bind(this,function(){o.login()?(this.errors.login=!1,t.go("home")):this.errors.login=!0})}]),parking.controller("navCtrl",["LoginService","$cookies",function(t,o){this.methods={},this.$cookies=o,this.LoginService=t,this.methods.logout=function(){t.logout()}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcmtpbmcuanMiLCJjb21tb24ubW9kdWxlLmpzIiwicGFya2luZy1jb3VudGVyLmRpcmVjdGl2ZS5qcyIsInRhYmxlLWZpbHRlci5kaXJlY3RpdmUuanMiLCJhZGQtbmV3LW1vZGFsLmNvbnRyb2xsZXIuanMiLCJ0YWJsZS1maWx0ZXIuY29udHJvbGxlci5qcyIsInNwb3RzLnNlcnZpY2UuanMiLCJzbG90cy5mYWN0b3J5LmpzIiwicGFya2luZy1zbG90LmRpcmVjdGl2ZS5qcyIsInBhcmtpbmctc2xvdC5jb250cm9sbGVyLmpzIiwiYWRkLW5ldy5jb250cm9sbGVyLmpzIiwicGFya2luZy1jb3VudGVyLmNvbnRyb2xsZXIuanMiLCJuZXctdmVoaWNsZS5kZXJlY3RpdmUuanMiLCJhdmFpbGFibGUtc2xvdHMuZmFjdG9yeS5qcyIsImxvZ2luLm1vZHVsZS5qcyIsImxvZ2luLnNlcnZpY2UuanMiLCJsb2dpbi5jb250cm9sbGVyLmpzIiwibmF2LmNvbnRyb2xsZXIuanMiXSwibmFtZXMiOlsicGFya2luZyIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkdXJsUm91dGVyUHJvdmlkZXIiLCIkc3RhdGVQcm92aWRlciIsIm90aGVyd2lzZSIsInN0YXRlIiwidGVtcGxhdGVVcmwiLCJ1cmwiLCJjb21tb24iLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsImNvbnRyb2xsZXIiLCJjb250cm9sbGVyQXMiLCJyZXBsYWNlIiwiJHNjb3BlIiwiJGxvZyIsIiR0aW1lb3V0IiwiU2xvdHNGYWN0b3J5IiwibmdEaWFsb2ciLCJuZXdVc2VyIiwidGhpcyIsInNwb3RzIiwic2F2ZU5ldyIsImJpbmQiLCJuYW1lIiwicGxhdGUiLCJ0eXBlIiwiY3JlYXRlVXNlciIsImNsb3NlQWxsIiwic2VydmljZSIsImZhY3RvcnkiLCIkaHR0cCIsIiRxIiwic3BvdHNVcmwiLCJhdmFpbGFibGVTbG90cyIsImluaXQiLCJnZXREYXRhIiwidGhlbiIsImRhdGEiLCJuZHgiLCJub3JtYWxpemVQbGF0ZSIsInNldEF2YWlsYWJsZVNsb3RzIiwicGFya2luZ0xpc3QiLCJsZW5ndGgiLCJjb3VudCIsImkiLCJnZXRBdmFpbGFibGVTbG90cyIsImFzc2lnblNsb3QiLCJzdHIiLCJhY3RpdmUiLCJtYXRjaCIsImpvaW4iLCJ0b1VwcGVyQ2FzZSIsInVzZXIiLCJzZWFyY2hQbGF0ZSIsInRvTG93ZXJDYXNlIiwicHVzaCIsIkRiUGxhdGUiLCJpbmZvIiwicG9zaXRpb24iLCJkZWZlciIsImdldCIsInN1Y2Nlc3MiLCJyZXNvbHZlIiwiZXJyb3IiLCJyZWplY3QiLCJwcm9taXNlIiwiU3BvdHNTZXJ2aWNlIiwiJHdhdGNoIiwibmV3dmFsdWUiLCJhZGROZXciLCJvcGVuIiwidGVtcGxhdGUiLCJjbGFzc05hbWUiLCJhdmFpbGFibGUiLCJsb2dpbiIsIiRzdGF0ZSIsIiRjb29raWVTdG9yZSIsInB1dCIsImlzTG9nZ2VkIiwidXNyU2Vzc2lvbiIsImxvZ291dCIsImRpZExvZ291dCIsInJlbW92ZSIsImdvIiwiTG9naW5TZXJ2aWNlIiwibWV0aG9kcyIsImVycm9ycyIsInN1Ym1pdCIsIiRjb29raWVzIl0sIm1hcHBpbmdzIjoiQUFDQSxZQUVBLElBQUFBLFNBQUFDLFFBQUFDLE9BQUEsV0FDQSxZQUNBLGdCQUNBLGVBQ0EsWUFDQSxhQUNBQyxRQUFBLHFCQUFBLGlCQUFBLFNBQUFDLEVBQUFDLEdBRUFELEVBQUFFLFVBQUEsS0FDQUQsRUFDQUUsTUFBQSxRQUNBQyxZQUFBLHVCQUNBQyxJQUFBLFNDWkFDLE9BQUFULFFBQUFDLE9BQUEsbUJDQUFRLFFBQUFDLFVBQUEsaUJBQUEsV0FDQSxPQUNBQyxTQUFBLElBQ0FKLFlBQUEsb0NBQ0FLLFdBQUEscUJBQ0FDLGFBQUEsVUFDQUMsU0FBQSxLQ05BTCxPQUFBQyxVQUFBLGNBQUEsV0FDQSxPQUNBQyxTQUFBLElBQ0FKLFlBQUEsaUNBQ0FLLFdBQUEsa0JBQ0FDLGFBQUEsU0FDQUMsU0FBQSxLQ05BTCxPQUFBRyxXQUFBLGVBQUEsU0FBQSxPQUFB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RyxRQUFBekIsS0FFQTBCLE1BQUEsV0FDQUosRUFBQUssV0FHQUwsRUFBQU0sU0FJQXBDLElDdkdBLElBQUE2QyxPQUFBNUUsUUFBQUMsT0FBQSxnQkFDQSxhQUdBMkUsT0FBQTFFLFFBQUEsaUJBQUEsU0FBQUUsR0FDQUEsRUFDQUUsTUFBQSxTQUNBTyxhQUFBLFFBQ0FELFdBQUEsWUFDQUwsWUFBQSx5QkFDQUMsSUFBQSxjQ1BBb0UsTUFBQTlDLFFBQUEsZ0JBQUEsU0FBQSxlQUFBLFNBQUErQyxFQUFBQyxHQUlBekQsS0FBQXVELE1BQUEsV0FHQSxNQURBRSxHQUFBQyxJQUFBLFVBQUEseUJBQ0EsR0FNQTFELEtBQUEyRCxTQUFBLFdBQ0EsR0FBQUMsR0FBQUgsRUFBQWhCLElBQUEsVUFFQSxPQUFBbUIsSUFDQSxHQUVBLEdBTUE1RCxLQUFBNkQsT0FBQSxXQUNBLEdBQUFDLElBQUEsQ0FFQUEsSUFDQUwsRUFBQU0sT0FBQSxXQUNBUCxFQUFBUSxHQUFBLFNBRUFyRSxLQUFBaUQsTUFBQSxvQ0NuQ0FXLE1BQUFoRSxXQUFBLGFBQUEsU0FBQSxlQUFBLFNBQUFpRSxFQUFBUyxHQUNBakUsS0FBQWlDLFFBQ0FqQyxLQUFBa0UsV0FDQWxFLEtBQUFtRSxVQUNBbkUsS0FBQW1FLE9BQUFaLE9BQUEsRUFLQXZELEtBQUFrRSxRQUFBRSxPQUFBekYsUUFBQXdCLEtBQUFILEtBQUEsV0FDQWlFLEVBQUFWLFNBQ0F2RCxLQUFBbUUsT0FBQVosT0FBQSxFQUNBQyxFQUFBUSxHQUFBLFNBRUFoRSxLQUFBbUUsT0FBQVosT0FBQSxPQ2RBN0UsUUFBQWEsV0FBQSxXQUFBLGVBQUEsV0FBQSxTQUFBMEUsRUFBQUksR0FDQXJFLEtBQUFrRSxXQUNBbEUsS0FBQXFFLFNBQUFBLEVBQ0FyRSxLQUFBaUUsYUFBQUEsRUFLQWpFLEtBQUFrRSxRQUFBTCxPQUFBLFdBQ0FJLEVBQUFKIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBBcHBzIG1vZHVsZVxuJ3VzZSBzdHJpY3QnO1xuXG52YXIgcGFya2luZyA9IGFuZ3VsYXIubW9kdWxlKCdwYXJraW5nJywgW1xuICAgICd1aS5yb3V0ZXInLFxuICAgICdjb21tb24ubW9kdWxlJyxcbiAgICAnbG9naW4ubW9kdWxlJyxcbiAgICAnbmdDb29raWVzJyxcbiAgICAnbmdEaWFsb2cnXG4gIF0pLmNvbmZpZyhmdW5jdGlvbiAoJHVybFJvdXRlclByb3ZpZGVyLCAkc3RhdGVQcm92aWRlcikge1xuICAgIC8vIFdoZW4gbm8gdXJsIGZpbmRzIGEgbWF0Y2ggcmVkaXJlY3QgdG8gL1xuICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy8nKTtcbiAgICAkc3RhdGVQcm92aWRlclxuICAgICAgLnN0YXRlKCdob21lJywge1xuICAgICAgICB0ZW1wbGF0ZVVybCA6ICd2aWV3cy9ob21lL2hvbWUuaHRtbCcsXG4gICAgICAgIHVybCA6ICcvJ1xuICAgICAgfSk7XG4gIH0pO1xuIiwiLy8gQ29tbW9uIG1vZHVsZVxuJ3VzZSBzdHJpY3QnO1xuXG52YXIgY29tbW9uID0gYW5ndWxhci5tb2R1bGUoJ2NvbW1vbi5tb2R1bGUnLCBbXSk7XG5cbiIsIi8vIERpcmVjdGl2ZSBmb3IgY291bnRlciBpbiB0aGUgVUlcbid1c2Ugc3RyaWN0JztcblxuY29tbW9uLmRpcmVjdGl2ZSgncGFya2luZ0NvdW50ZXInLCBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiB7XG4gICAgcmVzdHJpY3QgOiAnRScsXG4gICAgdGVtcGxhdGVVcmwgOiAndmlld3MvY29tbW9uL3BhcmtpbmctY291bnRlci5odG1sJyxcbiAgICBjb250cm9sbGVyIDogJ3BhcmtpbmdDb3VudGVyQ3RybCcsXG4gICAgY29udHJvbGxlckFzIDogJ2NvdW50ZXInLFxuICAgIHJlcGxhY2UgOiB0cnVlXG4gIH07XG59KTtcbiIsIi8vICBDdXN0b20gRGlyZWN0aXZlIGZvciBmaWx0ZXIgZnVuY3Rpb25hbGl0eVxuJ3VzZSBzdHJpY3QnO1xuXG5jb21tb24uZGlyZWN0aXZlKCd0YWJsZUZpbHRlcicsIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJue1xuICAgIHJlc3RyaWN0OiAnRScsXG4gICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9jb21tb24vdGFibGUtZmlsdGVyLmh0bWwnLFxuICAgIGNvbnRyb2xsZXI6ICd0YWJsZUZpbHRlckN0cmwnLFxuICAgIGNvbnRyb2xsZXJBczogJ2ZpbHRlcicsXG4gICAgcmVwbGFjZTogdHJ1ZVxuICB9O1xufSk7XG4iLCIvLyBDb250cm9sbGVyIHRvIG1hbmFnZSBldmVudHMgcmVsYXRlZCB0byBtb2RhbCBvZiBuZXcgdXNlclxuJ3VzZSBzdHJpY3QnO1xuIFxuY29tbW9uLmNvbnRyb2xsZXIoJ2FkZE5ld01vZGFsJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvZywgJHRpbWVvdXQsIFNsb3RzRmFjdG9yeSwgbmdEaWFsb2cpe1xuXG4gIHZhciBuZXdVc2VyO1xuICB0aGlzLnNwb3RzID0gU2xvdHNGYWN0b3J5LnNwb3RzO1xuXG4gICRzY29wZS5zYXZlTmV3ID0gYW5ndWxhci5iaW5kKHRoaXMsIGZ1bmN0aW9uKCkge1xuICAgIFxuICAgIG5ld1VzZXIgPSB7XG4gICAgICBuYW1lOiAkc2NvcGUubmFtZSxcbiAgICAgIHBsYXRlOiAkc2NvcGUucGxhdGUsXG4gICAgICB0eXBlOiAkc2NvcGUudHlwZVxuICAgIH07XG4gICAgU2xvdHNGYWN0b3J5LmNyZWF0ZVVzZXIobmV3VXNlcik7XG4gICAgbmdEaWFsb2cuY2xvc2VBbGwoKTtcbiAgfSk7XG5cbiAgXG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmNvbW1vbi5jb250cm9sbGVyKCd0YWJsZUZpbHRlckN0cmwnLCBmdW5jdGlvbigpIHt9KTsiLCIvLyBTcG90cyBzZXJ2aWNlXG4ndXNlIHN0cmljdCc7XG5cbmNvbW1vbi5zZXJ2aWNlKCdTcG90c1NlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsICRxKSB7XG5cbn0pO1xuIiwiLy8gRmFjdG9yeSB0aGF0IHN0b3JlcyBhbGwgdGhlIGRhdGEgcmVsYXRlZCB0byBhdmFpbGFibGUgcGFya2luZyBsb3RzXG4ndXNlIHN0cmljdCc7XG5cbmNvbW1vbi5mYWN0b3J5KCdTbG90c0ZhY3RvcnknLCBmdW5jdGlvbiAoJGh0dHAsICRxLCAkbG9nLCAkdGltZW91dCkge1xuICB2YXIgZmFjdG9yeSA9IHt9LFxuICAgIHRvdGFsU2xvdHMgPSAxMCxcbiAgICBzcG90c1VybCA9ICcvc3BvdHMnLFxuICAgIGF2YWlsYWJsZVNsb3RzID0gMDtcblxuICBmYWN0b3J5LnNwb3RzID0gW107XG5cbiAgLy8gRmFjdG9yeSBJbml0XG4gIGZhY3RvcnkuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmdldERhdGEoc3BvdHNVcmwpXG4gICAgICAudGhlbihhbmd1bGFyLmJpbmQodGhpcywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgZm9yKHZhciBuZHggaW4gZGF0YSl7XG4gICAgICAgICAgZGF0YVtuZHhdLnBsYXRlID0gZmFjdG9yeS5ub3JtYWxpemVQbGF0ZShkYXRhW25keF0ucGxhdGUpO1xuICAgICAgICB9XG4gICAgICAgIGZhY3Rvcnkuc3BvdHMgPSBkYXRhO1xuICAgICAgICBmYWN0b3J5LnNldEF2YWlsYWJsZVNsb3RzKCk7XG4gICAgICB9KSk7XG4gIH1cblxuICAvLyBBdmFpbGFibGUgc2xvdHNcbiAgZmFjdG9yeS5zZXRBdmFpbGFibGVTbG90cyA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgcGFya2luZ0xpc3QgPSBmYWN0b3J5LnNwb3RzLmxlbmd0aCxcbiAgICAgIGNvdW50ID0gMDtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFya2luZ0xpc3Q7IGkrKykge1xuICAgICAgY291bnQgKz0gKGZhY3Rvcnkuc3BvdHNbaV0uYWN0aXZlKSA/IDEgOiAwO1xuICAgIH07XG4gICAgaWYoY291bnQgPD0gMTApe1xuICAgICAgYXZhaWxhYmxlU2xvdHMgPSBjb3VudDtcbiAgICB9O1xuICB9O1xuXG4gIGZhY3RvcnkuZ2V0QXZhaWxhYmxlU2xvdHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGF2YWlsYWJsZVNsb3RzO1xuICB9O1xuXG4gIGZhY3RvcnkuYXNzaWduU2xvdCA9IGZ1bmN0aW9uIChwbGF0ZSkge1xuICAgIHZhciBzdHI7XG5cbiAgICBwbGF0ZSA9IGZhY3Rvcnkubm9ybWFsaXplUGxhdGUocGxhdGUpO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmYWN0b3J5LnNwb3RzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBzdHIgPSBmYWN0b3J5Lm5vcm1hbGl6ZVBsYXRlKGZhY3Rvcnkuc3BvdHNbaV0ucGxhdGUpO1xuXG4gICAgICBpZiAocGxhdGUgPT0gc3RyKSB7XG4gICAgICAgICAgaWYgKCFmYWN0b3J5LnNwb3RzW2ldLmFjdGl2ZSkge1xuICAgICAgICAgICAgZmFjdG9yeS5zcG90c1tpXS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgZmFjdG9yeS5zcG90c1tpXS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIGZhY3Rvcnkuc2V0QXZhaWxhYmxlU2xvdHMoKTtcbiAgICAgIH07XG4gICAgfTtcbiAgfTtcbiAgLy8gRm9ybWF0IElEIG9mIHZlaGljbGVcblxuICBmYWN0b3J5Lm5vcm1hbGl6ZVBsYXRlID0gZnVuY3Rpb24gKHBsYXRlKXtcbiAgICByZXR1cm4gcGxhdGUubWF0Y2goL1tBLVphLXowLTldL2dpKS5qb2luKCcnKS50b1VwcGVyQ2FzZSgpOyAgXG4gIH07XG4gIC8vSW5zZXJ0IG5ldyB2ZWhpY2xlXG4gIGZhY3RvcnkuY3JlYXRlVXNlciA9IGZ1bmN0aW9uICh1c2VyKSB7XG5cbiAgICBpZiAodHlwZW9mIGZhY3Rvcnkuc2VhcmNoUGxhdGUodXNlci5wbGF0ZSkgPT09ICdvYmplY3QnKSByZXR1cm47XG4gICAgXG4gICAgdmFyIG5ld1VzZXIgPSB7XG4gICAgICBhY3RpdmU6IGZhbHNlLFxuICAgICAgdHlwZTogdXNlci50eXBlLnRvTG93ZXJDYXNlKCksXG4gICAgICBwbGF0ZTogZmFjdG9yeS5ub3JtYWxpemVQbGF0ZSh1c2VyLnBsYXRlKSxcbiAgICAgIG5hbWU6IHVzZXIubmFtZVxuICAgIH07XG5cbiAgICBmYWN0b3J5LnNwb3RzLnB1c2gobmV3VXNlcik7XG4gIH07XG5cbiAgLy8gU2VhcmNoIHBsYXRlXG4gIGZhY3Rvcnkuc2VhcmNoUGxhdGUgPSBmdW5jdGlvbiAocGxhdGUpe1xuXG4gICAgcGxhdGUgPSBmYWN0b3J5Lm5vcm1hbGl6ZVBsYXRlKHBsYXRlKTtcbiAgICAvLyBJdGVyYXRvciB0byB2ZXJpZnkgdGhhdCB0aGUgdXNlciBwbGF0ZSBpcyBub3QgcHJlc2VudCBpbiB0aGUgY3VycmVudCBhcnJheSBcbiAgICBmb3IodmFyIG5keCBpbiBmYWN0b3J5LnNwb3RzKXtcblxuICAgICAgdmFyIERiUGxhdGUgPSBmYWN0b3J5Lm5vcm1hbGl6ZVBsYXRlKGZhY3Rvcnkuc3BvdHNbbmR4XS5wbGF0ZSk7XG4gICAgICAkbG9nLmluZm8oRGJQbGF0ZSwgcGxhdGUpO1xuICAgICAgaWYgKERiUGxhdGUgPT09IHBsYXRlKSByZXR1cm4geyBwb3NpdGlvbjogbmR4IH07XG4gICAgfTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG4gIC8vIEh0dHAgUmVxdWVzdCB0byBwYXJraW5nIHVzZXJzIG9iamVjdFxuICBmYWN0b3J5LmdldERhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcblxuICAgICRodHRwLmdldChzcG90c1VybClcbiAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgZGVmZXIucmVzb2x2ZShkYXRhKTtcbiAgICAgIH0pXG4gICAgICAuZXJyb3IoZnVuY3Rpb24oKSB7XG4gICAgICAgIGRlZmVyLnJlamVjdCgpO1xuICAgICAgfSk7XG5cbiAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcbiAgfTtcblxuICAvLyByZXR1cm4gZmFjdG9yeSBvYmplY3RcbiAgcmV0dXJuIGZhY3Rvcnk7XG59KTsiLCIvLyBQYXJraW5nIHNsb3QgZGlyZWN0aXZlXG4ndXNlIHN0cmljdCc7XG5cbmNvbW1vbi5kaXJlY3RpdmUoJ3BhcmtpbmdTbG90JywgZnVuY3Rpb24gKCkge1xuICByZXR1cm4ge1xuICAgIHJlc3RyaWN0IDogJ0UnLFxuICAgIHRlbXBsYXRlVXJsIDogJ3ZpZXdzL2NvbW1vbi9wYXJraW5nLXNsb3QuaHRtbCcsXG4gICAgY29udHJvbGxlciA6ICdwYXJraW5nU2xvdEN0cmwnLFxuICAgIGNvbnRyb2xsZXJBczogJ3Nsb3RzJyxcbiAgICByZXBsYWNlIDogdHJ1ZVxuICB9O1xufSk7XG5cbiIsIi8vIFBhcmtpbmcgU2xvdCBDb250cm9sbGVyXG4ndXNlIHN0cmljdCc7XG5cbmNvbW1vbi5jb250cm9sbGVyKCdwYXJraW5nU2xvdEN0cmwnLCBmdW5jdGlvbiAoU3BvdHNTZXJ2aWNlLCBTbG90c0ZhY3RvcnksICRsb2csICRzY29wZSkge1xuICAvLyBXaWxsIGhvbGQgcGFya2luZyBzcG90cyBpbmZvXG4gIHRoaXMuc3BvdHMgPSB7fTtcblxuICAvLyBJbml0aWFsaXRhdGlvbiBvZiBTbG90c0ZhY3RvcnlcbiAgU2xvdHNGYWN0b3J5LmluaXQoKTtcblxuICAvLyBXYXRjaCBmb3IgYW55IGNoYW5nZSBpbiBzcG90cyBsaXN0XG4gICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIFNsb3RzRmFjdG9yeS5zcG90cztcbiAgfSwgYW5ndWxhci5iaW5kKHRoaXMsIGZ1bmN0aW9uIChuZXd2YWx1ZSkge1xuICAgIHRoaXMuc3BvdHMgPSBuZXd2YWx1ZTtcbiAgfSkpO1xuXG5cbiAgdGhpcy5hc3NpZ25TbG90ID0gZnVuY3Rpb24gKHBsYXRlKSB7XG4gICBTbG90c0ZhY3RvcnkuYXNzaWduU2xvdChwbGF0ZSk7XG4gICAgdGhpcy5zcG90cyA9IFNsb3RzRmFjdG9yeS5zcG90cztcbiAgfTtcbn0pOyIsIi8vIENvbnRyb2xsZXIgdG8gbWFuYWdlIGV2ZW50cyByZWxhdGVkIHRvIG5ldyB1c2VyIGluc2VydFxuJ3VzZSBzdHJpY3QnO1xuIFxuY29tbW9uLmNvbnRyb2xsZXIoJ2FkZE5ld0N0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9nLCBuZ0RpYWxvZywgU2xvdHNGYWN0b3J5KXtcblxuICAkc2NvcGUuYWRkTmV3ID0gZnVuY3Rpb24oKSB7XG4gICAgbmdEaWFsb2cub3Blbih7IFxuICAgICAgdGVtcGxhdGU6ICd2aWV3cy9jb21tb24vbmV3LXZlaGljbGUtbW9kYWwuaHRtbCcsXG4gICAgICBjbGFzc05hbWU6ICdtb2RhbC1jb250YWluZXInLFxuICAgICAgY29udHJvbGxlcjogJ2FkZE5ld01vZGFsJyBcbiAgICB9KTtcbiAgfTtcblxufSk7IiwiLy8gcGFya2luZyBjb3VudGVyIGNvbnRyb2xsZXJcbid1c2Ugc3RyaWN0JztcblxuY29tbW9uLmNvbnRyb2xsZXIoJ3BhcmtpbmdDb3VudGVyQ3RybCcsIGZ1bmN0aW9uIChTbG90c0ZhY3RvcnksICRzY29wZSkge1xuICB0aGlzLmF2YWlsYWJsZSA9IFNsb3RzRmFjdG9yeS5nZXRBdmFpbGFibGVTbG90cygpO1xuXG4gICRzY29wZS4kd2F0Y2goU2xvdHNGYWN0b3J5LmdldEF2YWlsYWJsZVNsb3RzLCBhbmd1bGFyLmJpbmQodGhpcywgZnVuY3Rpb24gKG5ld3ZhbHVlKSB7XG4gICAgdGhpcy5hdmFpbGFibGUgPSBuZXd2YWx1ZTtcbiAgfSkpO1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5jb21tb24uZGlyZWN0aXZlKCduZXdWZWhpY2xlJywgZnVuY3Rpb24oKSB7XG4gIHJldHVybntcbiAgICByZXN0cmljdDogJ0UnLFxuICAgIHRlbXBsYXRlVXJsOid2aWV3cy9jb21tb24vbmV3LXZlaGljbGUuaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ2FkZE5ld0N0cmwnLFxuICAgIGNvbnRyb2xsZXJBczogJ25ldycsXG4gICAgcmVwbGFjZTogdHJ1ZVxuICB9O1xufSk7IiwiLy8gRmFjdG9yeSB0aGF0IHN0b3JlcyBhbGwgdGhlIGRhdGEgcmVsYXRlZCB0byBhdmFpbGFibGUgcGFya2luZyBsb3RzXG4ndXNlIHN0cmljdCc7XG5cbmNvbW1vbi5mYWN0b3J5KCdTbG90c0ZhY3RvcnknLCBmdW5jdGlvbiAoJGh0dHAsICRxLCAkbG9nLCAkdGltZW91dCkge1xuICB2YXIgZmFjdG9yeSA9IHt9LFxuICAgIHRvdGFsU2xvdHMgPSAxMCxcbiAgICBzcG90c1VybCA9ICcvc3BvdHMnLFxuICAgIGF2YWlsYWJsZVNsb3RzID0gMDtcblxuICBmYWN0b3J5LnNwb3RzID0gW107XG5cbiAgLy8gRmFjdG9yeSBJbml0XG4gIGZhY3RvcnkuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmdldERhdGEoc3BvdHNVcmwpXG4gICAgICAudGhlbihhbmd1bGFyLmJpbmQodGhpcywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgZm9yKHZhciBuZHggaW4gZGF0YSl7XG4gICAgICAgICAgZGF0YVtuZHhdLnBsYXRlID0gZmFjdG9yeS5ub3JtYWxpemVQbGF0ZShkYXRhW25keF0ucGxhdGUpO1xuICAgICAgICB9XG4gICAgICAgIGZhY3Rvcnkuc3BvdHMgPSBkYXRhO1xuICAgICAgICBmYWN0b3J5LnNldEF2YWlsYWJsZVNsb3RzKCk7XG4gICAgICB9KSk7XG4gIH1cblxuICAvLyBBdmFpbGFibGUgc2xvdHNcbiAgZmFjdG9yeS5zZXRBdmFpbGFibGVTbG90cyA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgcGFya2luZ0xpc3QgPSBmYWN0b3J5LnNwb3RzLmxlbmd0aCxcbiAgICAgIGNvdW50ID0gMDtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFya2luZ0xpc3Q7IGkrKykge1xuICAgICAgY291bnQgKz0gKGZhY3Rvcnkuc3BvdHNbaV0uYWN0aXZlKSA/IDEgOiAwO1xuICAgIH07XG5cbiAgICBhdmFpbGFibGVTbG90cyA9IGNvdW50O1xuICB9O1xuXG4gIGZhY3RvcnkuZ2V0QXZhaWxhYmxlU2xvdHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGF2YWlsYWJsZVNsb3RzO1xuICB9O1xuXG4gIGZhY3RvcnkuYXNzaWduU2xvdCA9IGZ1bmN0aW9uIChwbGF0ZSkge1xuICAgIHZhciBzdHI7XG5cbiAgICBwbGF0ZSA9IGZhY3Rvcnkubm9ybWFsaXplUGxhdGUocGxhdGUpO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmYWN0b3J5LnNwb3RzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBzdHIgPSBmYWN0b3J5Lm5vcm1hbGl6ZVBsYXRlKGZhY3Rvcnkuc3BvdHNbaV0ucGxhdGUpO1xuXG4gICAgICBpZiAocGxhdGUgPT0gc3RyKSB7XG4gICAgICAgICAgaWYgKCFmYWN0b3J5LnNwb3RzW2ldLmFjdGl2ZSkge1xuICAgICAgICAgICAgZmFjdG9yeS5zcG90c1tpXS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgZmFjdG9yeS5zcG90c1tpXS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIGZhY3Rvcnkuc2V0QXZhaWxhYmxlU2xvdHMoKTtcbiAgICAgIH07XG4gICAgfTtcbiAgfTtcbiAgLy8gRm9ybWF0IElEIG9mIHZlaGljbGVcblxuICBmYWN0b3J5Lm5vcm1hbGl6ZVBsYXRlID0gZnVuY3Rpb24gKHBsYXRlKXtcbiAgICByZXR1cm4gcGxhdGUubWF0Y2goL1tBLVphLXowLTldL2dpKS5qb2luKCcnKS50b1VwcGVyQ2FzZSgpOyAgXG4gIH07XG4gIC8vSW5zZXJ0IG5ldyB2ZWhpY2xlXG4gIGZhY3RvcnkuY3JlYXRlVXNlciA9IGZ1bmN0aW9uICh1c2VyKSB7XG5cbiAgICBpZiAodHlwZW9mIGZhY3Rvcnkuc2VhcmNoUGxhdGUodXNlci5wbGF0ZSkgPT09ICdvYmplY3QnKSByZXR1cm47XG4gICAgXG4gICAgdmFyIG5ld1VzZXIgPSB7XG4gICAgICBhY3RpdmU6IGZhbHNlLFxuICAgICAgdHlwZTogdXNlci50eXBlLnRvTG93ZXJDYXNlKCksXG4gICAgICBwbGF0ZTogZmFjdG9yeS5ub3JtYWxpemVQbGF0ZSh1c2VyLnBsYXRlKSxcbiAgICAgIG5hbWU6IHVzZXIubmFtZVxuICAgIH07XG5cbiAgICBmYWN0b3J5LnNwb3RzLnB1c2gobmV3VXNlcik7XG4gIH07XG5cbiAgLy8gU2VhcmNoIHBsYXRlXG4gIGZhY3Rvcnkuc2VhcmNoUGxhdGUgPSBmdW5jdGlvbiAocGxhdGUpe1xuXG4gICAgcGxhdGUgPSBmYWN0b3J5Lm5vcm1hbGl6ZVBsYXRlKHBsYXRlKTtcbiAgICAvLyBJdGVyYXRvciB0byB2ZXJpZnkgdGhhdCB0aGUgdXNlciBwbGF0ZSBpcyBub3QgcHJlc2VudCBpbiB0aGUgY3VycmVudCBhcnJheSBcbiAgICBmb3IodmFyIG5keCBpbiBmYWN0b3J5LnNwb3RzKXtcblxuICAgICAgdmFyIERiUGxhdGUgPSBmYWN0b3J5Lm5vcm1hbGl6ZVBsYXRlKGZhY3Rvcnkuc3BvdHNbbmR4XS5wbGF0ZSk7XG4gICAgICAkbG9nLmluZm8oRGJQbGF0ZSwgcGxhdGUpO1xuICAgICAgaWYgKERiUGxhdGUgPT09IHBsYXRlKSByZXR1cm4geyBwb3NpdGlvbjogbmR4IH07XG4gICAgfTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG4gIC8vIEh0dHAgUmVxdWVzdCB0byBwYXJraW5nIHVzZXJzIG9iamVjdFxuICBmYWN0b3J5LmdldERhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcblxuICAgICRodHRwLmdldChzcG90c1VybClcbiAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgZGVmZXIucmVzb2x2ZShkYXRhKTtcbiAgICAgIH0pXG4gICAgICAuZXJyb3IoZnVuY3Rpb24oKSB7XG4gICAgICAgIGRlZmVyLnJlamVjdCgpO1xuICAgICAgfSk7XG5cbiAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcbiAgfTtcblxuICAvLyByZXR1cm4gZmFjdG9yeSBvYmplY3RcbiAgcmV0dXJuIGZhY3Rvcnk7XG59KTsiLCIvLyBMb2dpbiBtb2R1bGVcbid1c2Ugc3RyaWN0JztcblxudmFyIGxvZ2luID0gYW5ndWxhci5tb2R1bGUoJ2xvZ2luLm1vZHVsZScsIFtcbiAgICAnbmdDb29raWVzJ1xuICBdKTtcblxubG9naW4uY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcikge1xuICAkc3RhdGVQcm92aWRlclxuICAgIC5zdGF0ZSgnbG9naW4nLCB7XG4gICAgICBjb250cm9sbGVyQXMgOiAnbG9naW4nLFxuICAgICAgY29udHJvbGxlciA6ICdsb2dpbkN0cmwnLFxuICAgICAgdGVtcGxhdGVVcmwgOiAndmlld3MvbG9naW4vbG9naW4uaHRtbCcsXG4gICAgICB1cmwgOiAnL2xvZ2luJ1xuICAgIH0pO1xufSk7IiwiLy8gTG9naW4gc2VydmljZVxuJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIFNlcnZpY2UgZm9yIHZhbGlkYXRpb24gb2YgdXNlciBjcmVkZW50aWFsc1xuICovXG5sb2dpbi5zZXJ2aWNlKCdMb2dpblNlcnZpY2UnLCBmdW5jdGlvbiBMb2dpblNlcnZpY2UoJHN0YXRlLCAkY29va2llU3RvcmUpIHtcbiAgLyoqXG4gICAqIFNlcnZpY2UgdGhhdCBsb2dzIHVzZXJcbiAgICovXG4gIHRoaXMubG9naW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgLy8gVGhpcyByZXR1cm4gc3RhdGVtZW50IHdpbGwgYmUgcmVwbGFjZSB3aXRoIGEgc2VydmljZS5cbiAgICAkY29va2llU3RvcmUucHV0KCdzZXNzaW9uJywgJ3BhcmtpbmcgdXNlciBzZXNzaW9uJyk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH07XG5cbiAgLyoqXG4gICAqIFNlcnZpY2UgdGhhdCB2YWxpZGF0ZXMgaWYgdXNlciBpcyBsb2dnZWQgaW5cbiAgICovXG4gIHRoaXMuaXNMb2dnZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHVzclNlc3Npb24gPSAkY29va2llU3RvcmUuZ2V0KCdzZXNzaW9uJyk7XG4gICAgLy8gVGhpcyByZXR1cm4gc3RhdGVtZW50IHdpbGwgYmUgcmVwbGFjZSB3aXRoIGEgc2VydmljZS5cbiAgICBpZih1c3JTZXNzaW9uKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZXJ2aWNlIHRvIGxvZ291dCBvciBraWxsIHRoZSB1c2VyIHNlc3Npb25cbiAgICovXG4gIHRoaXMubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBkaWRMb2dvdXQgPSB0cnVlO1xuICAgIC8vIFRoaXMgY29uZGl0aW9uYWwgd2lsbCBiZSByZXBsYWNlIHdpdGggYSBzZXJ2aWNlLlxuICAgIGlmKGRpZExvZ291dCkge1xuICAgICAgJGNvb2tpZVN0b3JlLnJlbW92ZSgnc2Vzc2lvbicpO1xuICAgICAgJHN0YXRlLmdvKCdob21lJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICRsb2cuZXJyb3IoJ1RoZSB1c2VyIGRvZXNuXFwndCB3YW5uYSBnby4uLicpO1xuICAgIH07XG4gIH07XG59KTsiLCIvLyBMb2dpbiBjb250cm9sbGVyXG4ndXNlIHN0cmljdCc7XG5cbmxvZ2luLmNvbnRyb2xsZXIoJ2xvZ2luQ3RybCcsIGZ1bmN0aW9uICgkc3RhdGUsIExvZ2luU2VydmljZSkge1xuICB0aGlzLnVzZXIgPSB7fTtcbiAgdGhpcy5tZXRob2RzID0ge307XG4gIHRoaXMuZXJyb3JzID0ge307XG4gIHRoaXMuZXJyb3JzLmxvZ2luID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEN0YSBmb3IgdXNlciBzdWJtaXR0aW5nIHRoZSBsb2dpbiBmb3JtXG4gICAqL1xuICB0aGlzLm1ldGhvZHMuc3VibWl0ID0gYW5ndWxhci5iaW5kKHRoaXMsIGZ1bmN0aW9uICgpIHtcbiAgICBpZihMb2dpblNlcnZpY2UubG9naW4oKSkge1xuICAgICAgdGhpcy5lcnJvcnMubG9naW4gPSBmYWxzZVxuICAgICAgJHN0YXRlLmdvKCdob21lJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZXJyb3JzLmxvZ2luID0gdHJ1ZVxuICAgIH1cbiAgfSk7XG59KTsiLCIvLyBuYXYgY29udHJvbGxlclxuJ3VzZSBzdHJpY3QnO1xuXG5wYXJraW5nLmNvbnRyb2xsZXIoJ25hdkN0cmwnLCBmdW5jdGlvbiAoTG9naW5TZXJ2aWNlLCAkY29va2llcykge1xuICB0aGlzLm1ldGhvZHMgPSB7fTtcbiAgdGhpcy4kY29va2llcyA9ICRjb29raWVzO1xuICB0aGlzLkxvZ2luU2VydmljZSA9IExvZ2luU2VydmljZTtcblxuICAvKipcbiAgICogQ2FsbHMgbG9nb3V0IHNlcnZpY2VcbiAgICovXG4gIHRoaXMubWV0aG9kcy5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgTG9naW5TZXJ2aWNlLmxvZ291dCgpO1xuICB9O1xufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9