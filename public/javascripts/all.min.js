"use strict";var parking=angular.module("parking",["ui.router","common.module","login.module","ngCookies","ngDialog"]).config(["$urlRouterProvider","$stateProvider",function(t,e){t.otherwise("/"),e.state("home",{templateUrl:"views/home/home.html",url:"/"})}]),common=angular.module("common.module",[]);common.directive("parkingCounter",function(){return{restrict:"E",templateUrl:"views/common/parking-counter.html",controller:"parkingCounterCtrl",controllerAs:"counter",replace:!0}}),common.directive("tableFilter",function(){return{restrict:"E",templateUrl:"views/common/table-filter.html",controller:"tableFilterCtrl",controllerAs:"filter",replace:!0}}),common.controller("addNewModal",["$scope","$log","$timeout","SlotsFactory","ngDialog",function(t,e,o,n,r){var i;this.spots=n.spots,t.saveNew=angular.bind(this,function(){i={name:t.name,plate:t.plate,type:t.type},n.createUser(i),r.closeAll()})}]),common.controller("tableFilterCtrl",function(){}),common.service("SpotsService",["$http","$q",function(){}]),common.factory("SlotsFactory",["$http","$q","$log","$timeout",function(t,e,o){var n={},r="/spots",i=0;return n.spots=[],n.init=function(){this.getData(r).then(angular.bind(this,function(t){for(var e in t)t[e].plate=n.normalizePlate(t[e].plate);n.spots=t,n.setAvailableSlots()}))},n.setAvailableSlots=function(){for(var t=n.spots.length,e=0,o=0;t>o;o++)e+=n.spots[o].active?1:0;10>=e&&(i=e)},n.getAvailableSlots=function(){return i},n.assignSlot=function(t){var e;t=n.normalizePlate(t);for(var o=0;o<n.spots.length;o++)e=n.normalizePlate(n.spots[o].plate),t==e&&(n.spots[o].active=n.spots[o].active?!1:!0,n.setAvailableSlots())},n.normalizePlate=function(t){return t.match(/[A-Za-z0-9]/gi).join("").toUpperCase()},n.createUser=function(t){if("object"!=typeof n.searchPlate(t.plate)){var e={active:!1,type:t.type.toLowerCase(),plate:n.normalizePlate(t.plate),name:t.name};n.spots.push(e)}},n.searchPlate=function(t){t=n.normalizePlate(t);for(var e in n.spots){var r=n.normalizePlate(n.spots[e].plate);if(o.info(r,t),r===t)return{position:e}}return!1},n.getData=function(){var o=e.defer();return t.get(r).success(function(t){o.resolve(t)}).error(function(){o.reject()}),o.promise},n}]),common.directive("parkingSlot",function(){return{restrict:"E",templateUrl:"views/common/parking-slot.html",controller:"parkingSlotCtrl",controllerAs:"slots",replace:!0}}),common.controller("parkingSlotCtrl",["SpotsService","SlotsFactory","$log","$scope","ngDialog",function(t,e,o,n,r){this.spots={},e.init(),n.$watch(function(){return e.spots},angular.bind(this,function(t){this.spots=t})),this.assignSlot=function(t){e.assignSlot(t),this.spots=e.spots},n.edit=function(t){var o=e.searchPlate(t);""!=o.position?r.open({template:"views/common/new-vehicle-modal.html",className:"modal-container",controller:"addNewModal",scope:n}):alert("user not found!"),console.info(o)}}]),common.controller("addNewCtrl",["$scope","$log","ngDialog","SlotsFactory",function(t,e,o){t.addNew=function(){o.open({template:"views/common/new-vehicle-modal.html",className:"modal-container",controller:"addNewModal"})}}]),common.controller("parkingCounterCtrl",["SlotsFactory","$scope",function(t,e){this.available=t.getAvailableSlots(),e.$watch(t.getAvailableSlots,angular.bind(this,function(t){this.available=t}))}]),common.directive("newVehicle",function(){return{restrict:"E",templateUrl:"views/common/new-vehicle.html",controller:"addNewCtrl",controllerAs:"new",replace:!0}}),common.factory("SlotsFactory",["$http","$q","$log","$timeout",function(t,e){var o={},n="/spots",r=0;return o.spots=[],o.init=function(){this.getData(n).then(angular.bind(this,function(t){for(var e in t)t[e].plate=o.normalizePlate(t[e].plate);o.spots=t,o.setAvailableSlots()}))},o.setAvailableSlots=function(){for(var t=o.spots.length,e=0,n=0;t>n;n++)e+=o.spots[n].active?1:0;r=e},o.getAvailableSlots=function(){return r},o.assignSlot=function(t){var e;t=o.normalizePlate(t);for(var n=0;n<o.spots.length;n++)e=o.normalizePlate(o.spots[n].plate),t==e&&(o.spots[n].active=o.spots[n].active?!1:!0,o.setAvailableSlots())},o.normalizePlate=function(t){return t.match(/[A-Za-z0-9]/gi).join("").toUpperCase()},o.createUser=function(t){if("object"!=typeof o.searchPlate(t.plate)){var e={active:!1,type:t.type.toLowerCase(),plate:o.normalizePlate(t.plate),name:t.name};o.setData(e).then(angular.bind(this,function(t){o.spots.push(e),console.log(t)}),function(){alert("save fail!!!")})}},o.searchPlate=function(t){t=o.normalizePlate(t);for(var e in o.spots){var n=o.normalizePlate(o.spots[e].plate);if(n===t)return{position:e}}return!1},o.getData=function(){var o=e.defer();return t.get(n).success(function(t){o.resolve(t)}).error(function(){o.reject()}),o.promise},o.setData=function(o){var r=e.defer();return t.post(n,o).success(function(t){r.resolve(t)}).error(function(){r.reject()}),r.promise},o.editData=function(o){var r=e.defer();return t.put(n,o).success(function(t){r.resolve(t)}).error(function(){r.reject()}),r.promise},o}]);var login=angular.module("login.module",["ngCookies"]);login.config(["$stateProvider",function(t){t.state("login",{controllerAs:"login",controller:"loginCtrl",templateUrl:"views/login/login.html",url:"/login"})}]),login.service("LoginService",["$state","$cookieStore",function(t,e){this.login=function(){return e.put("session","parking user session"),!0},this.isLogged=function(){var t=e.get("session");return t?!0:!1},this.logout=function(){var o=!0;o?(e.remove("session"),t.go("home")):$log.error("The user doesn't wanna go...")}}]),login.controller("loginCtrl",["$state","LoginService",function(t,e){this.user={},this.methods={},this.errors={},this.errors.login=!1,this.methods.submit=angular.bind(this,function(){e.login()?(this.errors.login=!1,t.go("home")):this.errors.login=!0})}]),parking.controller("navCtrl",["LoginService","$cookies",function(t,e){this.methods={},this.$cookies=e,this.LoginService=t,this.methods.logout=function(){t.logout()}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcmtpbmcuanMiLCJjb21tb24ubW9kdWxlLmpzIiwicGFya2luZy1jb3VudGVyLmRpcmVjdGl2ZS5qcyIsInRhYmxlLWZpbHRlci5kaXJlY3RpdmUuanMiLCJhZGQtbmV3LW1vZGFsLmNvbnRyb2xsZXIuanMiLCJ0YWJsZS1maWx0ZXIuY29udHJvbGxlci5qcyIsInNwb3RzLnNlcnZpY2UuanMiLCJzbG90cy5mYWN0b3J5LmpzIiwicGFya2luZy1zbG90LmRpcmVjdGl2ZS5qcyIsInBhcmtpbmctc2xvdC5jb250cm9sbGVyLmpzIiwiYWRkLW5ldy5jb250cm9sbGVyLmpzIiwicGFya2luZy1jb3VudGVyLmNvbnRyb2xsZXIuanMiLCJuZXctdmVoaWNsZS5kZXJlY3RpdmUuanMiLCJhdmFpbGFibGUtc2xvdHMuZmFjdG9yeS5qcyIsImxvZ2luLm1vZHVsZS5qcyIsImxvZ2luLnNlcnZpY2UuanMiLCJsb2dpbi5jb250cm9sbGVyLmpzIiwibmF2LmNvbnRyb2xsZXIuanMiXSwibmFtZXMiOlsicGFya2luZyIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkdXJsUm91dGVyUHJvdmlkZXIiLCIkc3RhdGVQcm92aWRlciIsIm90aGVyd2lzZSIsInN0YXRlIiwidGVtcGxhdGVVcmwiLCJ1cmwiLCJjb21tb24iLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsImNvbnRyb2xsZXIiLCJjb250cm9sbGVyQXMiLCJyZXBsYWNlIiwiJHNjb3BlIiwiJGxvZyIsIiR0aW1lb3V0IiwiU2xvdHNGYWN0b3J5IiwibmdEaWFsb2ciLCJuZXdVc2VyIiwidGhpcyIsInNwb3RzIiwic2F2ZU5ldyIsImJpbmQiLCJuYW1lIiwicGxhdGUiLCJ0eXBlIiwiY3JlYXRlVXNlciIsImNsb3NlQWxsIiwic2VydmljZSIsImZhY3RvcnkiLCIkaHR0cCIsIiRxIiwic3BvdHNVcmwiLCJhdmFpbGFibGVTbG90cyIsImluaXQiLCJnZXREYXRhIiwidGhlbiIsImRhdGEiLCJuZHgiLCJub3JtYWxpemVQbGF0ZSIsInNldEF2YWlsYWJsZVNsb3RzIiwicGFya2luZ0xpc3QiLCJsZW5ndGgiLCJjb3VudCIsImkiLCJnZXRBdmFpbGFibGVTbG90cyIsImFzc2lnblNsb3QiLCJzdHIiLCJhY3RpdmUiLCJtYXRjaCIsImpvaW4iLCJ0b1VwcGVyQ2FzZSIsInVzZXIiLCJzZWFyY2hQbGF0ZSIsInRvTG93ZXJDYXNlIiwicHVzaCIsIkRiUGxhdGUiLCJpbmZvIiwicG9zaXRpb24iLCJkZWZlciIsImdldCIsInN1Y2Nlc3MiLCJyZXNvbHZlIiwiZXJyb3IiLCJyZWplY3QiLCJwcm9taXNlIiwiU3BvdHNTZXJ2aWNlIiwiJHdhdGNoIiwibmV3dmFsdWUiLCJlZGl0IiwiaWQiLCJ1c3IiLCJvcGVuIiwidGVtcGxhdGUiLCJjbGFzc05hbWUiLCJzY29wZSIsImFsZXJ0IiwiY29uc29sZSIsImFkZE5ldyIsImF2YWlsYWJsZSIsInNldERhdGEiLCJsb2ciLCJwb3N0IiwiZWRpdERhdGEiLCJwdXQiLCJsb2dpbiIsIiRzdGF0ZSIsIiRjb29raWVTdG9yZSIsImlzTG9nZ2VkIiwidXNyU2Vzc2lvbiIsImxvZ291dCIsImRpZExvZ291dCIsInJlbW92ZSIsImdvIiwiTG9naW5TZXJ2aWNlIiwibWV0aG9kcyIsImVycm9ycyIsInN1Ym1pdCIsIiRjb29raWVzIl0sIm1hcHBpbmdzIjoiQUFDQSxZQUVBLElBQUFBLFNBQUFDLFFBQUFDLE9BQUEsV0FDQSxZQUNBLGdCQUNBLGVBQ0EsWUFDQSxhQUNBQyxRQUFBLHFCQUFBLGlCQUFBLFNBQUFDLEVBQUFDLEdBRUFELEVBQUFFLFVBQUEsS0FDQUQsRUFDQUUsTUFBQSxRQUNBQyxZQUFBLHVCQUNBQyxJQUFBLFNDWkFDLE9BQUFULFFBQUFDLE9BQUEsbUJDQUFRLFFBQUFDLFVBQUEsaUJBQUEsV0FDQSxPQUNBQyxTQUFBLElBQ0FKLFlBQUEsb0NBQ0FLLFdBQUEscUJBQ0FDLGFBQUEsVUFDQUMsU0FBQSxLQ05BTCxPQUFBQyxVQUFBLGNBQUEsV0FDQSxPQUNBQyxTQUFBLElBQ0FKLFlBQUEsaUNBQ0FLLFdBQUEsa0JBQ0FDLGFBQUEsU0FDQUMsU0FBQSxLQ05BTCxPQUFBRyxXQUFBLGVBQUEsU0FBQSxPQUFBLFdBQUEsZUFBQSxXQUFBLFNBQUFHLEVBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBRUEsR0FBQUMsRUFDQUMsTUFBQUMsTUFBQUosRUFBQUksTUFFQVAsRUFBQVEsUUFBQXZCLFFBQUF3QixLQUFBSCxLQUFBLFdBRUFELEdBQ0FLLEtBQUFWLEVBQUFVLEtBQ0FDLE1BQUFYLEVBQUFXLE1BQ0FDLEtBQUFaLEVBQUFZLE1BRUFULEVBQUFVLFdBQUFSLEdBQ0FELEVBQUFVLGdCQ2RBcEIsT0FBQUcsV0FBQSxrQkFBQSxjQ0NBSCxPQUFBcUIsUUFBQSxnQkFBQSxRQUFBLEtBQUEsZUNBQXJCLE9BQUFzQixRQUFBLGdCQUFBLFFBQUEsS0FBQSxPQUFBLFdBQUEsU0FBQUMsRUFBQUMsRUFBQWpCLEdBQ0EsR0FBQWUsTUFFQUcsRUFBQSxTQUNBQyxFQUFBLENBb0dBLE9BbEdBSixHQUFBVCxTQUdBUyxFQUFBSyxLQUFBLFdBQ0FmLEtBQUFnQixRQUFBSCxHQUNBSSxLQUFBdEMsUUFBQXdCLEtBQUFILEtBQUEsU0FBQWtCLEdBQ0EsSUFBQSxHQUFBQyxLQUFBRCxHQUNBQSxFQUFBQyxHQUFBZCxNQUFBSyxFQUFBVSxlQUFBRixFQUFBQyxHQUFBZCxNQUVBSyxHQUFBVCxNQUFBaUIsRUFDQVIsRUFBQVcsd0JBS0FYLEVBQUFXLGtCQUFBLFdBSUEsSUFBQSxHQUhBQyxHQUFBWixFQUFBVCxNQUFBc0IsT0FDQUMsRUFBQSxFQUVBQyxFQUFBLEVBQUFILEVBQUFHLEVBQUFBLElBQ0FELEdBQUFkLEVBQUFULE1BQUF3QixHQUFBLE9BQUEsRUFBQSxDQUVBLEtBQUFELElBQ0FWLEVBQUFVLElBSUFkLEVBQUFnQixrQkFBQSxXQUNBLE1BQUFaLElBR0FKLEVBQUFpQixXQUFBLFNBQUF0QixHQUNBLEdBQUF1QixFQUVBdkIsR0FBQUssRUFBQVUsZUFBQWYsRUFFQSxLQUFBLEdBQUFvQixHQUFBLEVBQUFBLEVBQUFmLEVBQUFULE1BQUFzQixPQUFBRSxJQUNBRyxFQUFBbEIsRUFBQVUsZUFBQVYsRUFBQVQsTUFBQXdCLEdBQUFwQixPQUVBQSxHQUFBdUIsSUFJQWxCLEVBQUFULE1BQUF3QixHQUFBSSxPQUhBbkIsRUFBQVQsTUFBQXdCLEdBQUFJLFFBR0EsR0FGQSxFQUlBbkIsRUFBQVcsc0JBTUFYLEVBQUFVLGVBQUEsU0FBQWYsR0FDQSxNQUFBQSxHQUFBeUIsTUFBQSxpQkFBQUMsS0FBQSxJQUFBQyxlQUdBdEIsRUFBQUgsV0FBQSxTQUFBMEIsR0FFQSxHQUFBLGdCQUFBdkIsR0FBQXdCLFlBQUFELEVBQUE1QixPQUFBLENBRUEsR0FBQU4sSUFDQThCLFFBQUEsRUFDQXZCLEtBQUEyQixFQUFBM0IsS0FBQTZCLGNBQ0E5QixNQUFBSyxFQUFBVSxlQUFBYSxFQUFBNUIsT0FDQUQsS0FBQTZCLEVBQUE3QixLQUdBTSxHQUFBVCxNQUFBbUMsS0FBQXJDLEtBSUFXLEVBQUF3QixZQUFBLFNBQUE3QixHQUVBQSxFQUFBSyxFQUFBVSxlQUFBZixFQUVBLEtBQUEsR0FBQWMsS0FBQVQsR0FBQVQsTUFBQSxDQUVBLEdBQUFvQyxHQUFBM0IsRUFBQVUsZUFBQVYsRUFBQVQsTUFBQWtCLEdBQUFkLE1BRUEsSUFEQVYsRUFBQTJDLEtBQUFELEVBQUFoQyxHQUNBZ0MsSUFBQWhDLEVBQUEsT0FBQWtDLFNBQUFwQixHQUVBLE9BQUEsR0FHQVQsRUFBQU0sUUFBQSxXQUNBLEdBQUF3QixHQUFBNUIsRUFBQTRCLE9BVUEsT0FSQTdCLEdBQUE4QixJQUFBNUIsR0FDQTZCLFFBQUEsU0FBQXhCLEdBQ0FzQixFQUFBRyxRQUFBekIsS0FFQTBCLE1BQUEsV0FDQUosRUFBQUssV0FHQUwsRUFBQU0sU0FJQXBDLEtDeEdBdEIsT0FBQUMsVUFBQSxjQUFBLFdBQ0EsT0FDQUMsU0FBQSxJQUNBSixZQUFBLGlDQUNBSyxXQUFBLGtCQUNBQyxhQUFBLFFBQ0FDLFNBQUEsS0NOQUwsT0FBQUcsV0FBQSxtQkFBQSxlQUFBLGVBQUEsT0FBQSxTQUFBLFdBQUEsU0FBQXdELEVBQUFsRCxFQUFBRixFQUFBRCxFQUFBSSxHQUVBRSxLQUFBQyxTQUdBSixFQUFBa0IsT0FHQXJCLEVBQUFzRCxPQUFBLFdBQ0EsTUFBQW5ELEdBQUFJLE9BQ0F0QixRQUFBd0IsS0FBQUgsS0FBQSxTQUFBaUQsR0FDQWpELEtBQUFDLE1BQUFnRCxLQUlBakQsS0FBQTJCLFdBQUEsU0FBQXRCLEdBQ0FSLEVBQUE4QixXQUFBdEIsR0FDQUwsS0FBQUMsTUFBQUosRUFBQUksT0FHQVAsRUFBQXdELEtBQUEsU0FBQUMsR0FDQSxHQUFBQyxHQUFBdkQsRUFBQXFDLFlBQUFpQixFQUNBLEtBQUFDLEVBQUFiLFNBRUF6QyxFQUFBdUQsTUFDQUMsU0FBQSxzQ0FDQUMsVUFBQSxrQkFDQWhFLFdBQUEsY0FDQWlFLE1BQUE5RCxJQUdBK0QsTUFBQSxtQkFFQUMsUUFBQXBCLEtBQUFjLE9DakNBaEUsT0FBQUcsV0FBQSxjQUFBLFNBQUEsT0FBQSxXQUFBLGVBQUEsU0FBQUcsRUFBQUMsRUFBQUcsR0FFQUosRUFBQWlFLE9BQUEsV0FDQTdELEVBQUF1RCxNQUNBQyxTQUFBLHNDQUNBQyxVQUFBLGtCQUNBaEUsV0FBQSxvQkNOQUgsT0FBQUcsV0FBQSxzQkFBQSxlQUFBLFNBQUEsU0FBQU0sRUFBQUgsR0FDQU0sS0FBQTRELFVBQUEvRCxFQUFBNkIsb0JBRUFoQyxFQUFBc0QsT0FBQW5ELEVBQUE2QixrQkFBQS9DLFFBQUF3QixLQUFBSCxLQUFBLFNBQUFpRCxHQUNBakQsS0FBQTRELFVBQUFYLFFDTEE3RCxPQUFBQyxVQUFBLGFBQUEsV0FDQSxPQUNBQyxTQUFBLElBQ0FKLFlBQUEsZ0NBQ0FLLFdBQUEsYUFDQUMsYUFBQSxNQUNBQyxTQUFBLEtDTEFMLE9BQUFzQixRQUFBLGdCQUFBLFFBQUEsS0FBQSxPQUFBLFdBQUEsU0FBQUMsRUFBQUMsR0FDQSxHQUFBRixNQUVBRyxFQUFBLFNBQ0FDLEVBQUEsQ0F3SUEsT0F0SUFKLEdBQUFULFNBR0FTLEVBQUFLLEtBQUEsV0FDQWYsS0FBQWdCLFFBQUFILEdBQ0FJLEtBQUF0QyxRQUFBd0IsS0FBQUgsS0FBQSxTQUFBa0IsR0FDQSxJQUFBLEdBQUFDLEtBQUFELEdBQ0FBLEVBQUFDLEdBQUFkLE1BQUFLLEVBQUFVLGVBQUFGLEVBQUFDLEdBQUFkLE1BRUFLLEdBQUFULE1BQUFpQixFQUNBUixFQUFBVyx3QkFLQVgsRUFBQVcsa0JBQUEsV0FJQSxJQUFBLEdBSEFDLEdBQUFaLEVBQUFULE1BQUFzQixPQUNBQyxFQUFBLEVBRUFDLEVBQUEsRUFBQUgsRUFBQUcsRUFBQUEsSUFDQUQsR0FBQWQsRUFBQVQsTUFBQXdCLEdBQUEsT0FBQSxFQUFBLENBR0FYLEdBQUFVLEdBR0FkLEVBQUFnQixrQkFBQSxXQUNBLE1BQUFaLElBR0FKLEVBQUFpQixXQUFBLFNBQUF0QixHQUNBLEdBQUF1QixFQUVBdkIsR0FBQUssRUFBQVUsZUFBQWYsRUFFQSxLQUFBLEdBQUFvQixHQUFBLEVBQUFBLEVBQUFmLEVBQUFULE1BQUFzQixPQUFBRSxJQUNBRyxFQUFBbEIsRUFBQVUsZUFBQVYsRUFBQVQsTUFBQXdCLEdBQUFwQixPQUVBQSxHQUFBdUIsSUFJQWxCLEVBQUFULE1BQUF3QixHQUFBSSxPQUhBbkIsRUFBQVQsTUFBQXdCLEdBQUFJLFFBR0EsR0FGQSxFQUlBbkIsRUFBQVcsc0JBTUFYLEVBQUFVLGVBQUEsU0FBQWYsR0FDQSxNQUFBQSxHQUFBeUIsTUFBQSxpQkFBQUMsS0FBQSxJQUFBQyxlQUlBdEIsRUFBQUgsV0FBQSxTQUFBMEIsR0FFQSxHQUFBLGdCQUFBdkIsR0FBQXdCLFlBQUFELEVBQUE1QixPQUFBLENBRUEsR0FBQU4sSUFDQThCLFFBQUEsRUFDQXZCLEtBQUEyQixFQUFBM0IsS0FBQTZCLGNBQ0E5QixNQUFBSyxFQUFBVSxlQUFBYSxFQUFBNUIsT0FDQUQsS0FBQTZCLEVBQUE3QixLQUdBTSxHQUFBbUQsUUFBQTlELEdBQ0FrQixLQUFBdEMsUUFBQXdCLEtBQUFILEtBQUEsU0FBQWtCLEdBQ0FSLEVBQUFULE1BQUFtQyxLQUFBckMsR0FDQTJELFFBQUFJLElBQUE1QyxLQUVBLFdBQ0F1QyxNQUFBLG9CQU1BL0MsRUFBQXdCLFlBQUEsU0FBQTdCLEdBRUFBLEVBQUFLLEVBQUFVLGVBQUFmLEVBRUEsS0FBQSxHQUFBYyxLQUFBVCxHQUFBVCxNQUFBLENBRUEsR0FBQW9DLEdBQUEzQixFQUFBVSxlQUFBVixFQUFBVCxNQUFBa0IsR0FBQWQsTUFDQSxJQUFBZ0MsSUFBQWhDLEVBQUEsT0FBQWtDLFNBQUFwQixHQUVBLE9BQUEsR0FJQVQsRUFBQU0sUUFBQSxXQUNBLEdBQUF3QixHQUFBNUIsRUFBQTRCLE9BVUEsT0FSQTdCLEdBQUE4QixJQUFBNUIsR0FDQTZCLFFBQUEsU0FBQXhCLEdBQ0FzQixFQUFBRyxRQUFBekIsS0FFQTBCLE1BQUEsV0FDQUosRUFBQUssV0FHQUwsRUFBQU0sU0FHQXBDLEVBQUFtRCxRQUFBLFNBQUE1QixHQUNBLEdBQUFPLEdBQUE1QixFQUFBNEIsT0FVQSxPQVJBN0IsR0FBQW9ELEtBQUFsRCxFQUFBb0IsR0FDQVMsUUFBQSxTQUFBeEIsR0FDQXNCLEVBQUFHLFFBQUF6QixLQUVBMEIsTUFBQSxXQUNBSixFQUFBSyxXQUdBTCxFQUFBTSxTQUdBcEMsRUFBQXNELFNBQUEsU0FBQS9CLEdBQ0EsR0FBQU8sR0FBQTVCLEVBQUE0QixPQVVBLE9BUkE3QixHQUFBc0QsSUFBQXBELEVBQUFvQixHQUNBUyxRQUFBLFNBQUF4QixHQUNBc0IsRUFBQUcsUUFBQXpCLEtBRUEwQixNQUFBLFdBQ0FKLEVBQUFLLFdBR0FMLEVBQUFNLFNBSUFwQyxJQzVJQSxJQUFBd0QsT0FBQXZGLFFBQUFDLE9BQUEsZ0JBQ0EsYUFHQXNGLE9BQUFyRixRQUFBLGlCQUFBLFNBQUFFLEdBQ0FBLEVBQ0FFLE1BQUEsU0FDQU8sYUFBQSxRQUNBRCxXQUFBLFlBQ0FMLFlBQUEseUJBQ0FDLElBQUEsY0NQQStFLE1BQUF6RCxRQUFBLGdCQUFBLFNBQUEsZUFBQSxTQUFBMEQsRUFBQUMsR0FJQXBFLEtBQUFrRSxNQUFBLFdBR0EsTUFEQUUsR0FBQUgsSUFBQSxVQUFBLHlCQUNBLEdBTUFqRSxLQUFBcUUsU0FBQSxXQUNBLEdBQUFDLEdBQUFGLEVBQUEzQixJQUFBLFVBRUEsT0FBQTZCLElBQ0EsR0FFQSxHQU1BdEUsS0FBQXVFLE9BQUEsV0FDQSxHQUFBQyxJQUFBLENBRUFBLElBQ0FKLEVBQUFLLE9BQUEsV0FDQU4sRUFBQU8sR0FBQSxTQUVBL0UsS0FBQWlELE1BQUEsb0NDbkNBc0IsTUFBQTNFLFdBQUEsYUFBQSxTQUFBLGVBQUEsU0FBQTRFLEVBQUFRLEdBQ0EzRSxLQUFBaUMsUUFDQWpDLEtBQUE0RSxXQUNBNUUsS0FBQTZFLFVBQ0E3RSxLQUFBNkUsT0FBQVgsT0FBQSxFQUtBbEUsS0FBQTRFLFFBQUFFLE9BQUFuRyxRQUFBd0IsS0FBQUgsS0FBQSxXQUNBMkUsRUFBQVQsU0FDQWxFLEtBQUE2RSxPQUFBWCxPQUFBLEVBQ0FDLEVBQUFPLEdBQUEsU0FFQTFFLEtBQUE2RSxPQUFBWCxPQUFBLE9DZEF4RixRQUFBYSxXQUFBLFdBQUEsZUFBQSxXQUFBLFNBQUFvRixFQUFBSSxHQUNBL0UsS0FBQTRFLFdBQ0E1RSxLQUFBK0UsU0FBQUEsRUFDQS9FLEtBQUEyRSxhQUFBQSxFQUtBM0UsS0FBQTRFLFFBQUFMLE9BQUEsV0FDQUksRUFBQUoiLCJmaWxlIjoiYWxsLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEFwcHMgbW9kdWxlXG4ndXNlIHN0cmljdCc7XG5cbnZhciBwYXJraW5nID0gYW5ndWxhci5tb2R1bGUoJ3BhcmtpbmcnLCBbXG4gICAgJ3VpLnJvdXRlcicsXG4gICAgJ2NvbW1vbi5tb2R1bGUnLFxuICAgICdsb2dpbi5tb2R1bGUnLFxuICAgICduZ0Nvb2tpZXMnLFxuICAgICduZ0RpYWxvZydcbiAgXSkuY29uZmlnKGZ1bmN0aW9uICgkdXJsUm91dGVyUHJvdmlkZXIsICRzdGF0ZVByb3ZpZGVyKSB7XG4gICAgLy8gV2hlbiBubyB1cmwgZmluZHMgYSBtYXRjaCByZWRpcmVjdCB0byAvXG4gICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnLycpO1xuICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAuc3RhdGUoJ2hvbWUnLCB7XG4gICAgICAgIHRlbXBsYXRlVXJsIDogJ3ZpZXdzL2hvbWUvaG9tZS5odG1sJyxcbiAgICAgICAgdXJsIDogJy8nXG4gICAgICB9KTtcbiAgfSk7XG4iLCIvLyBDb21tb24gbW9kdWxlXG4ndXNlIHN0cmljdCc7XG5cbnZhciBjb21tb24gPSBhbmd1bGFyLm1vZHVsZSgnY29tbW9uLm1vZHVsZScsIFtdKTtcblxuIiwiLy8gRGlyZWN0aXZlIGZvciBjb3VudGVyIGluIHRoZSBVSVxuJ3VzZSBzdHJpY3QnO1xuXG5jb21tb24uZGlyZWN0aXZlKCdwYXJraW5nQ291bnRlcicsIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIHtcbiAgICByZXN0cmljdCA6ICdFJyxcbiAgICB0ZW1wbGF0ZVVybCA6ICd2aWV3cy9jb21tb24vcGFya2luZy1jb3VudGVyLmh0bWwnLFxuICAgIGNvbnRyb2xsZXIgOiAncGFya2luZ0NvdW50ZXJDdHJsJyxcbiAgICBjb250cm9sbGVyQXMgOiAnY291bnRlcicsXG4gICAgcmVwbGFjZSA6IHRydWVcbiAgfTtcbn0pO1xuIiwiLy8gIEN1c3RvbSBEaXJlY3RpdmUgZm9yIGZpbHRlciBmdW5jdGlvbmFsaXR5XG4ndXNlIHN0cmljdCc7XG5cbmNvbW1vbi5kaXJlY3RpdmUoJ3RhYmxlRmlsdGVyJywgZnVuY3Rpb24gKCkge1xuICByZXR1cm57XG4gICAgcmVzdHJpY3Q6ICdFJyxcbiAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2NvbW1vbi90YWJsZS1maWx0ZXIuaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ3RhYmxlRmlsdGVyQ3RybCcsXG4gICAgY29udHJvbGxlckFzOiAnZmlsdGVyJyxcbiAgICByZXBsYWNlOiB0cnVlXG4gIH07XG59KTtcbiIsIi8vIENvbnRyb2xsZXIgdG8gbWFuYWdlIGV2ZW50cyByZWxhdGVkIHRvIG1vZGFsIG9mIG5ldyB1c2VyXG4ndXNlIHN0cmljdCc7XG4gXG5jb21tb24uY29udHJvbGxlcignYWRkTmV3TW9kYWwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9nLCAkdGltZW91dCwgU2xvdHNGYWN0b3J5LCBuZ0RpYWxvZyl7XG5cbiAgdmFyIG5ld1VzZXI7XG4gIHRoaXMuc3BvdHMgPSBTbG90c0ZhY3Rvcnkuc3BvdHM7XG5cbiAgJHNjb3BlLnNhdmVOZXcgPSBhbmd1bGFyLmJpbmQodGhpcywgZnVuY3Rpb24oKSB7XG4gICAgXG4gICAgbmV3VXNlciA9IHtcbiAgICAgIG5hbWU6ICRzY29wZS5uYW1lLFxuICAgICAgcGxhdGU6ICRzY29wZS5wbGF0ZSxcbiAgICAgIHR5cGU6ICRzY29wZS50eXBlXG4gICAgfTtcbiAgICBTbG90c0ZhY3RvcnkuY3JlYXRlVXNlcihuZXdVc2VyKTtcbiAgICBuZ0RpYWxvZy5jbG9zZUFsbCgpO1xuICB9KTtcblxuICBcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuY29tbW9uLmNvbnRyb2xsZXIoJ3RhYmxlRmlsdGVyQ3RybCcsIGZ1bmN0aW9uKCkge30pOyIsIi8vIFNwb3RzIHNlcnZpY2Vcbid1c2Ugc3RyaWN0JztcblxuY29tbW9uLnNlcnZpY2UoJ1Nwb3RzU2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCwgJHEpIHtcblxufSk7XG4iLCIvLyBGYWN0b3J5IHRoYXQgc3RvcmVzIGFsbCB0aGUgZGF0YSByZWxhdGVkIHRvIGF2YWlsYWJsZSBwYXJraW5nIGxvdHNcbid1c2Ugc3RyaWN0JztcblxuY29tbW9uLmZhY3RvcnkoJ1Nsb3RzRmFjdG9yeScsIGZ1bmN0aW9uICgkaHR0cCwgJHEsICRsb2csICR0aW1lb3V0KSB7XG4gIHZhciBmYWN0b3J5ID0ge30sXG4gICAgdG90YWxTbG90cyA9IDEwLFxuICAgIHNwb3RzVXJsID0gJy9zcG90cycsXG4gICAgYXZhaWxhYmxlU2xvdHMgPSAwO1xuXG4gIGZhY3Rvcnkuc3BvdHMgPSBbXTtcblxuICAvLyBGYWN0b3J5IEluaXRcbiAgZmFjdG9yeS5pbml0ID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZ2V0RGF0YShzcG90c1VybClcbiAgICAgIC50aGVuKGFuZ3VsYXIuYmluZCh0aGlzLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBmb3IodmFyIG5keCBpbiBkYXRhKXtcbiAgICAgICAgICBkYXRhW25keF0ucGxhdGUgPSBmYWN0b3J5Lm5vcm1hbGl6ZVBsYXRlKGRhdGFbbmR4XS5wbGF0ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZmFjdG9yeS5zcG90cyA9IGRhdGE7XG4gICAgICAgIGZhY3Rvcnkuc2V0QXZhaWxhYmxlU2xvdHMoKTtcbiAgICAgIH0pKTtcbiAgfVxuXG4gIC8vIEF2YWlsYWJsZSBzbG90c1xuICBmYWN0b3J5LnNldEF2YWlsYWJsZVNsb3RzID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBwYXJraW5nTGlzdCA9IGZhY3Rvcnkuc3BvdHMubGVuZ3RoLFxuICAgICAgY291bnQgPSAwO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJraW5nTGlzdDsgaSsrKSB7XG4gICAgICBjb3VudCArPSAoZmFjdG9yeS5zcG90c1tpXS5hY3RpdmUpID8gMSA6IDA7XG4gICAgfTtcbiAgICBpZihjb3VudCA8PSAxMCl7XG4gICAgICBhdmFpbGFibGVTbG90cyA9IGNvdW50O1xuICAgIH07XG4gIH07XG5cbiAgZmFjdG9yeS5nZXRBdmFpbGFibGVTbG90cyA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gYXZhaWxhYmxlU2xvdHM7XG4gIH07XG5cbiAgZmFjdG9yeS5hc3NpZ25TbG90ID0gZnVuY3Rpb24gKHBsYXRlKSB7XG4gICAgdmFyIHN0cjtcblxuICAgIHBsYXRlID0gZmFjdG9yeS5ub3JtYWxpemVQbGF0ZShwbGF0ZSk7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZhY3Rvcnkuc3BvdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHN0ciA9IGZhY3Rvcnkubm9ybWFsaXplUGxhdGUoZmFjdG9yeS5zcG90c1tpXS5wbGF0ZSk7XG5cbiAgICAgIGlmIChwbGF0ZSA9PSBzdHIpIHtcbiAgICAgICAgICBpZiAoIWZhY3Rvcnkuc3BvdHNbaV0uYWN0aXZlKSB7XG4gICAgICAgICAgICBmYWN0b3J5LnNwb3RzW2ldLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBmYWN0b3J5LnNwb3RzW2ldLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgIH07XG4gICAgICAgICAgZmFjdG9yeS5zZXRBdmFpbGFibGVTbG90cygpO1xuICAgICAgfTtcbiAgICB9O1xuICB9O1xuICAvLyBGb3JtYXQgSUQgb2YgdmVoaWNsZVxuXG4gIGZhY3Rvcnkubm9ybWFsaXplUGxhdGUgPSBmdW5jdGlvbiAocGxhdGUpe1xuICAgIHJldHVybiBwbGF0ZS5tYXRjaCgvW0EtWmEtejAtOV0vZ2kpLmpvaW4oJycpLnRvVXBwZXJDYXNlKCk7ICBcbiAgfTtcbiAgLy9JbnNlcnQgbmV3IHZlaGljbGVcbiAgZmFjdG9yeS5jcmVhdGVVc2VyID0gZnVuY3Rpb24gKHVzZXIpIHtcblxuICAgIGlmICh0eXBlb2YgZmFjdG9yeS5zZWFyY2hQbGF0ZSh1c2VyLnBsYXRlKSA9PT0gJ29iamVjdCcpIHJldHVybjtcbiAgICBcbiAgICB2YXIgbmV3VXNlciA9IHtcbiAgICAgIGFjdGl2ZTogZmFsc2UsXG4gICAgICB0eXBlOiB1c2VyLnR5cGUudG9Mb3dlckNhc2UoKSxcbiAgICAgIHBsYXRlOiBmYWN0b3J5Lm5vcm1hbGl6ZVBsYXRlKHVzZXIucGxhdGUpLFxuICAgICAgbmFtZTogdXNlci5uYW1lXG4gICAgfTtcblxuICAgIGZhY3Rvcnkuc3BvdHMucHVzaChuZXdVc2VyKTtcbiAgfTtcblxuICAvLyBTZWFyY2ggcGxhdGVcbiAgZmFjdG9yeS5zZWFyY2hQbGF0ZSA9IGZ1bmN0aW9uIChwbGF0ZSl7XG5cbiAgICBwbGF0ZSA9IGZhY3Rvcnkubm9ybWFsaXplUGxhdGUocGxhdGUpO1xuICAgIC8vIEl0ZXJhdG9yIHRvIHZlcmlmeSB0aGF0IHRoZSB1c2VyIHBsYXRlIGlzIG5vdCBwcmVzZW50IGluIHRoZSBjdXJyZW50IGFycmF5IFxuICAgIGZvcih2YXIgbmR4IGluIGZhY3Rvcnkuc3BvdHMpe1xuXG4gICAgICB2YXIgRGJQbGF0ZSA9IGZhY3Rvcnkubm9ybWFsaXplUGxhdGUoZmFjdG9yeS5zcG90c1tuZHhdLnBsYXRlKTtcbiAgICAgICRsb2cuaW5mbyhEYlBsYXRlLCBwbGF0ZSk7XG4gICAgICBpZiAoRGJQbGF0ZSA9PT0gcGxhdGUpIHJldHVybiB7IHBvc2l0aW9uOiBuZHggfTtcbiAgICB9O1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbiAgLy8gSHR0cCBSZXF1ZXN0IHRvIHBhcmtpbmcgdXNlcnMgb2JqZWN0XG4gIGZhY3RvcnkuZ2V0RGF0YSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xuXG4gICAgJGh0dHAuZ2V0KHNwb3RzVXJsKVxuICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICBkZWZlci5yZXNvbHZlKGRhdGEpO1xuICAgICAgfSlcbiAgICAgIC5lcnJvcihmdW5jdGlvbigpIHtcbiAgICAgICAgZGVmZXIucmVqZWN0KCk7XG4gICAgICB9KTtcblxuICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xuICB9O1xuXG4gIC8vIHJldHVybiBmYWN0b3J5IG9iamVjdFxuICByZXR1cm4gZmFjdG9yeTtcbn0pOyIsIi8vIFBhcmtpbmcgc2xvdCBkaXJlY3RpdmVcbid1c2Ugc3RyaWN0JztcblxuY29tbW9uLmRpcmVjdGl2ZSgncGFya2luZ1Nsb3QnLCBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiB7XG4gICAgcmVzdHJpY3QgOiAnRScsXG4gICAgdGVtcGxhdGVVcmwgOiAndmlld3MvY29tbW9uL3Bhcmtpbmctc2xvdC5odG1sJyxcbiAgICBjb250cm9sbGVyIDogJ3BhcmtpbmdTbG90Q3RybCcsXG4gICAgY29udHJvbGxlckFzOiAnc2xvdHMnLFxuICAgIHJlcGxhY2UgOiB0cnVlXG4gIH07XG59KTtcblxuIiwiLy8gUGFya2luZyBTbG90IENvbnRyb2xsZXJcbid1c2Ugc3RyaWN0JztcblxuY29tbW9uLmNvbnRyb2xsZXIoJ3BhcmtpbmdTbG90Q3RybCcsIGZ1bmN0aW9uIChTcG90c1NlcnZpY2UsIFNsb3RzRmFjdG9yeSwgJGxvZywgJHNjb3BlLCBuZ0RpYWxvZykge1xuICAvLyBXaWxsIGhvbGQgcGFya2luZyBzcG90cyBpbmZvXG4gIHRoaXMuc3BvdHMgPSB7fTtcblxuICAvLyBJbml0aWFsaXRhdGlvbiBvZiBTbG90c0ZhY3RvcnlcbiAgU2xvdHNGYWN0b3J5LmluaXQoKTtcblxuICAvLyBXYXRjaCBmb3IgYW55IGNoYW5nZSBpbiBzcG90cyBsaXN0XG4gICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIFNsb3RzRmFjdG9yeS5zcG90cztcbiAgfSwgYW5ndWxhci5iaW5kKHRoaXMsIGZ1bmN0aW9uIChuZXd2YWx1ZSkge1xuICAgIHRoaXMuc3BvdHMgPSBuZXd2YWx1ZTtcbiAgfSkpO1xuXG5cbiAgdGhpcy5hc3NpZ25TbG90ID0gZnVuY3Rpb24gKHBsYXRlKSB7XG4gICBTbG90c0ZhY3RvcnkuYXNzaWduU2xvdChwbGF0ZSk7XG4gICAgdGhpcy5zcG90cyA9IFNsb3RzRmFjdG9yeS5zcG90cztcbiAgfTtcblxuICAkc2NvcGUuZWRpdCA9IGZ1bmN0aW9uKGlkKXtcbiAgICB2YXIgdXNyID0gU2xvdHNGYWN0b3J5LnNlYXJjaFBsYXRlKGlkKTtcbiAgICBpZih1c3IucG9zaXRpb24gIT0gJycpIHtcbiAgICAgIC8vIGxhdW5jaCB0aGUgbW9kYWwgd2luZG93XG4gICAgICBuZ0RpYWxvZy5vcGVuKHsgXG4gICAgICAgIHRlbXBsYXRlOiAndmlld3MvY29tbW9uL25ldy12ZWhpY2xlLW1vZGFsLmh0bWwnLFxuICAgICAgICBjbGFzc05hbWU6ICdtb2RhbC1jb250YWluZXInLFxuICAgICAgICBjb250cm9sbGVyOiAnYWRkTmV3TW9kYWwnLFxuICAgICAgICBzY29wZTogJHNjb3BlICBcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBhbGVydCgndXNlciBub3QgZm91bmQhJyk7XG4gICAgfVxuICAgIGNvbnNvbGUuaW5mbyh1c3IpO1xuICB9XG59KTsiLCIvLyBDb250cm9sbGVyIHRvIG1hbmFnZSBldmVudHMgcmVsYXRlZCB0byBuZXcgdXNlciBpbnNlcnRcbid1c2Ugc3RyaWN0JztcbiBcbmNvbW1vbi5jb250cm9sbGVyKCdhZGROZXdDdHJsJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvZywgbmdEaWFsb2csIFNsb3RzRmFjdG9yeSl7XG5cbiAgJHNjb3BlLmFkZE5ldyA9IGZ1bmN0aW9uKCkge1xuICAgIG5nRGlhbG9nLm9wZW4oeyBcbiAgICAgIHRlbXBsYXRlOiAndmlld3MvY29tbW9uL25ldy12ZWhpY2xlLW1vZGFsLmh0bWwnLFxuICAgICAgY2xhc3NOYW1lOiAnbW9kYWwtY29udGFpbmVyJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdhZGROZXdNb2RhbCcgXG4gICAgfSk7XG4gIH07XG5cbn0pOyIsIi8vIHBhcmtpbmcgY291bnRlciBjb250cm9sbGVyXG4ndXNlIHN0cmljdCc7XG5cbmNvbW1vbi5jb250cm9sbGVyKCdwYXJraW5nQ291bnRlckN0cmwnLCBmdW5jdGlvbiAoU2xvdHNGYWN0b3J5LCAkc2NvcGUpIHtcbiAgdGhpcy5hdmFpbGFibGUgPSBTbG90c0ZhY3RvcnkuZ2V0QXZhaWxhYmxlU2xvdHMoKTtcblxuICAkc2NvcGUuJHdhdGNoKFNsb3RzRmFjdG9yeS5nZXRBdmFpbGFibGVTbG90cywgYW5ndWxhci5iaW5kKHRoaXMsIGZ1bmN0aW9uIChuZXd2YWx1ZSkge1xuICAgIHRoaXMuYXZhaWxhYmxlID0gbmV3dmFsdWU7XG4gIH0pKTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuY29tbW9uLmRpcmVjdGl2ZSgnbmV3VmVoaWNsZScsIGZ1bmN0aW9uKCkge1xuICByZXR1cm57XG4gICAgcmVzdHJpY3Q6ICdFJyxcbiAgICB0ZW1wbGF0ZVVybDondmlld3MvY29tbW9uL25ldy12ZWhpY2xlLmh0bWwnLFxuICAgIGNvbnRyb2xsZXI6ICdhZGROZXdDdHJsJyxcbiAgICBjb250cm9sbGVyQXM6ICduZXcnLFxuICAgIHJlcGxhY2U6IHRydWVcbiAgfTtcbn0pOyIsIi8vIEZhY3RvcnkgdGhhdCBzdG9yZXMgYWxsIHRoZSBkYXRhIHJlbGF0ZWQgdG8gYXZhaWxhYmxlIHBhcmtpbmcgbG90c1xuJ3VzZSBzdHJpY3QnO1xuXG5jb21tb24uZmFjdG9yeSgnU2xvdHNGYWN0b3J5JywgZnVuY3Rpb24gKCRodHRwLCAkcSwgJGxvZywgJHRpbWVvdXQpIHtcbiAgdmFyIGZhY3RvcnkgPSB7fSxcbiAgICB0b3RhbFNsb3RzID0gMTAsXG4gICAgc3BvdHNVcmwgPSAnL3Nwb3RzJyxcbiAgICBhdmFpbGFibGVTbG90cyA9IDA7XG5cbiAgZmFjdG9yeS5zcG90cyA9IFtdO1xuXG4gIC8vIEZhY3RvcnkgSW5pdFxuICBmYWN0b3J5LmluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5nZXREYXRhKHNwb3RzVXJsKVxuICAgICAgLnRoZW4oYW5ndWxhci5iaW5kKHRoaXMsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGZvcih2YXIgbmR4IGluIGRhdGEpe1xuICAgICAgICAgIGRhdGFbbmR4XS5wbGF0ZSA9IGZhY3Rvcnkubm9ybWFsaXplUGxhdGUoZGF0YVtuZHhdLnBsYXRlKTtcbiAgICAgICAgfVxuICAgICAgICBmYWN0b3J5LnNwb3RzID0gZGF0YTtcbiAgICAgICAgZmFjdG9yeS5zZXRBdmFpbGFibGVTbG90cygpO1xuICAgICAgfSkpO1xuICB9XG5cbiAgLy8gQXZhaWxhYmxlIHNsb3RzXG4gIGZhY3Rvcnkuc2V0QXZhaWxhYmxlU2xvdHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHBhcmtpbmdMaXN0ID0gZmFjdG9yeS5zcG90cy5sZW5ndGgsXG4gICAgICBjb3VudCA9IDA7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcmtpbmdMaXN0OyBpKyspIHtcbiAgICAgIGNvdW50ICs9IChmYWN0b3J5LnNwb3RzW2ldLmFjdGl2ZSkgPyAxIDogMDtcbiAgICB9O1xuXG4gICAgYXZhaWxhYmxlU2xvdHMgPSBjb3VudDtcbiAgfTtcblxuICBmYWN0b3J5LmdldEF2YWlsYWJsZVNsb3RzID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBhdmFpbGFibGVTbG90cztcbiAgfTtcblxuICBmYWN0b3J5LmFzc2lnblNsb3QgPSBmdW5jdGlvbiAocGxhdGUpIHtcbiAgICB2YXIgc3RyO1xuXG4gICAgcGxhdGUgPSBmYWN0b3J5Lm5vcm1hbGl6ZVBsYXRlKHBsYXRlKTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmFjdG9yeS5zcG90cy5sZW5ndGg7IGkrKykge1xuICAgICAgc3RyID0gZmFjdG9yeS5ub3JtYWxpemVQbGF0ZShmYWN0b3J5LnNwb3RzW2ldLnBsYXRlKTtcblxuICAgICAgaWYgKHBsYXRlID09IHN0cikge1xuICAgICAgICAgIGlmICghZmFjdG9yeS5zcG90c1tpXS5hY3RpdmUpIHtcbiAgICAgICAgICAgIGZhY3Rvcnkuc3BvdHNbaV0uYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGZhY3Rvcnkuc3BvdHNbaV0uYWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgfTtcbiAgICAgICAgICBmYWN0b3J5LnNldEF2YWlsYWJsZVNsb3RzKCk7XG4gICAgICB9O1xuICAgIH07XG4gIH07XG4gIC8vIEZvcm1hdCBJRCBvZiB2ZWhpY2xlXG5cbiAgZmFjdG9yeS5ub3JtYWxpemVQbGF0ZSA9IGZ1bmN0aW9uIChwbGF0ZSl7XG4gICAgcmV0dXJuIHBsYXRlLm1hdGNoKC9bQS1aYS16MC05XS9naSkuam9pbignJykudG9VcHBlckNhc2UoKTsgIFxuICB9O1xuXG4gIC8vSW5zZXJ0IG5ldyB2ZWhpY2xlXG4gIGZhY3RvcnkuY3JlYXRlVXNlciA9IGZ1bmN0aW9uICh1c2VyKSB7XG5cbiAgICBpZiAodHlwZW9mIGZhY3Rvcnkuc2VhcmNoUGxhdGUodXNlci5wbGF0ZSkgPT09ICdvYmplY3QnKSByZXR1cm47XG4gICAgXG4gICAgdmFyIG5ld1VzZXIgPSB7XG4gICAgICBhY3RpdmU6IGZhbHNlLFxuICAgICAgdHlwZTogdXNlci50eXBlLnRvTG93ZXJDYXNlKCksXG4gICAgICBwbGF0ZTogZmFjdG9yeS5ub3JtYWxpemVQbGF0ZSh1c2VyLnBsYXRlKSxcbiAgICAgIG5hbWU6IHVzZXIubmFtZVxuICAgIH07XG5cbiAgICBmYWN0b3J5LnNldERhdGEobmV3VXNlcilcbiAgICAgIC50aGVuKGFuZ3VsYXIuYmluZCh0aGlzLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBmYWN0b3J5LnNwb3RzLnB1c2gobmV3VXNlcik7XG4gICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgfSksXG4gICAgICAgIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgIGFsZXJ0KCdzYXZlIGZhaWwhISEnKTsgXG4gICAgICAgIH1cbiAgICAgICk7XG4gIH07XG5cbiAgLy8gU2VhcmNoIHBsYXRlXG4gIGZhY3Rvcnkuc2VhcmNoUGxhdGUgPSBmdW5jdGlvbiAocGxhdGUpe1xuXG4gICAgcGxhdGUgPSBmYWN0b3J5Lm5vcm1hbGl6ZVBsYXRlKHBsYXRlKTtcbiAgICAvLyBJdGVyYXRvciB0byB2ZXJpZnkgdGhhdCB0aGUgdXNlciBwbGF0ZSBpcyBub3QgcHJlc2VudCBpbiB0aGUgY3VycmVudCBhcnJheSBcbiAgICBmb3IodmFyIG5keCBpbiBmYWN0b3J5LnNwb3RzKXtcblxuICAgICAgdmFyIERiUGxhdGUgPSBmYWN0b3J5Lm5vcm1hbGl6ZVBsYXRlKGZhY3Rvcnkuc3BvdHNbbmR4XS5wbGF0ZSk7XG4gICAgICBpZiAoRGJQbGF0ZSA9PT0gcGxhdGUpIHJldHVybiB7IHBvc2l0aW9uOiBuZHggfTtcbiAgICB9O1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICAvLyBIdHRwIFJlcXVlc3QgdG8gcGFya2luZyB1c2VycyBvYmplY3RcbiAgZmFjdG9yeS5nZXREYXRhID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XG5cbiAgICAkaHR0cC5nZXQoc3BvdHNVcmwpXG4gICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIGRlZmVyLnJlc29sdmUoZGF0YSk7XG4gICAgICB9KVxuICAgICAgLmVycm9yKGZ1bmN0aW9uKCkge1xuICAgICAgICBkZWZlci5yZWplY3QoKTtcbiAgICAgIH0pO1xuXG4gICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XG4gIH07XG5cbiAgZmFjdG9yeS5zZXREYXRhID0gZnVuY3Rpb24gKHVzZXIpIHtcbiAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xuXG4gICAgJGh0dHAucG9zdChzcG90c1VybCwgdXNlcilcbiAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgZGVmZXIucmVzb2x2ZShkYXRhKTtcbiAgICAgIH0pXG4gICAgICAuZXJyb3IoZnVuY3Rpb24oKSB7XG4gICAgICAgIGRlZmVyLnJlamVjdCgpO1xuICAgICAgfSk7XG5cbiAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcbiAgfTtcblxuICBmYWN0b3J5LmVkaXREYXRhID0gZnVuY3Rpb24gKHVzZXIpIHtcbiAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xuXG4gICAgJGh0dHAucHV0KHNwb3RzVXJsLCB1c2VyKVxuICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICBkZWZlci5yZXNvbHZlKGRhdGEpO1xuICAgICAgfSlcbiAgICAgIC5lcnJvcihmdW5jdGlvbigpIHtcbiAgICAgICAgZGVmZXIucmVqZWN0KCk7XG4gICAgICB9KTtcblxuICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xuICB9O1xuXG4gIC8vIHJldHVybiBmYWN0b3J5IG9iamVjdFxuICByZXR1cm4gZmFjdG9yeTtcbn0pOyIsIi8vIExvZ2luIG1vZHVsZVxuJ3VzZSBzdHJpY3QnO1xuXG52YXIgbG9naW4gPSBhbmd1bGFyLm1vZHVsZSgnbG9naW4ubW9kdWxlJywgW1xuICAgICduZ0Nvb2tpZXMnXG4gIF0pO1xuXG5sb2dpbi5jb25maWcoZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyKSB7XG4gICRzdGF0ZVByb3ZpZGVyXG4gICAgLnN0YXRlKCdsb2dpbicsIHtcbiAgICAgIGNvbnRyb2xsZXJBcyA6ICdsb2dpbicsXG4gICAgICBjb250cm9sbGVyIDogJ2xvZ2luQ3RybCcsXG4gICAgICB0ZW1wbGF0ZVVybCA6ICd2aWV3cy9sb2dpbi9sb2dpbi5odG1sJyxcbiAgICAgIHVybCA6ICcvbG9naW4nXG4gICAgfSk7XG59KTsiLCIvLyBMb2dpbiBzZXJ2aWNlXG4ndXNlIHN0cmljdCc7XG5cbi8qKlxuICogU2VydmljZSBmb3IgdmFsaWRhdGlvbiBvZiB1c2VyIGNyZWRlbnRpYWxzXG4gKi9cbmxvZ2luLnNlcnZpY2UoJ0xvZ2luU2VydmljZScsIGZ1bmN0aW9uIExvZ2luU2VydmljZSgkc3RhdGUsICRjb29raWVTdG9yZSkge1xuICAvKipcbiAgICogU2VydmljZSB0aGF0IGxvZ3MgdXNlclxuICAgKi9cbiAgdGhpcy5sb2dpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAvLyBUaGlzIHJldHVybiBzdGF0ZW1lbnQgd2lsbCBiZSByZXBsYWNlIHdpdGggYSBzZXJ2aWNlLlxuICAgICRjb29raWVTdG9yZS5wdXQoJ3Nlc3Npb24nLCAncGFya2luZyB1c2VyIHNlc3Npb24nKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfTtcblxuICAvKipcbiAgICogU2VydmljZSB0aGF0IHZhbGlkYXRlcyBpZiB1c2VyIGlzIGxvZ2dlZCBpblxuICAgKi9cbiAgdGhpcy5pc0xvZ2dlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdXNyU2Vzc2lvbiA9ICRjb29raWVTdG9yZS5nZXQoJ3Nlc3Npb24nKTtcbiAgICAvLyBUaGlzIHJldHVybiBzdGF0ZW1lbnQgd2lsbCBiZSByZXBsYWNlIHdpdGggYSBzZXJ2aWNlLlxuICAgIGlmKHVzclNlc3Npb24pIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgLyoqXG4gICAqIFNlcnZpY2UgdG8gbG9nb3V0IG9yIGtpbGwgdGhlIHVzZXIgc2Vzc2lvblxuICAgKi9cbiAgdGhpcy5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGRpZExvZ291dCA9IHRydWU7XG4gICAgLy8gVGhpcyBjb25kaXRpb25hbCB3aWxsIGJlIHJlcGxhY2Ugd2l0aCBhIHNlcnZpY2UuXG4gICAgaWYoZGlkTG9nb3V0KSB7XG4gICAgICAkY29va2llU3RvcmUucmVtb3ZlKCdzZXNzaW9uJyk7XG4gICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGxvZy5lcnJvcignVGhlIHVzZXIgZG9lc25cXCd0IHdhbm5hIGdvLi4uJyk7XG4gICAgfTtcbiAgfTtcbn0pOyIsIi8vIExvZ2luIGNvbnRyb2xsZXJcbid1c2Ugc3RyaWN0JztcblxubG9naW4uY29udHJvbGxlcignbG9naW5DdHJsJywgZnVuY3Rpb24gKCRzdGF0ZSwgTG9naW5TZXJ2aWNlKSB7XG4gIHRoaXMudXNlciA9IHt9O1xuICB0aGlzLm1ldGhvZHMgPSB7fTtcbiAgdGhpcy5lcnJvcnMgPSB7fTtcbiAgdGhpcy5lcnJvcnMubG9naW4gPSBmYWxzZTtcblxuICAvKipcbiAgICogQ3RhIGZvciB1c2VyIHN1Ym1pdHRpbmcgdGhlIGxvZ2luIGZvcm1cbiAgICovXG4gIHRoaXMubWV0aG9kcy5zdWJtaXQgPSBhbmd1bGFyLmJpbmQodGhpcywgZnVuY3Rpb24gKCkge1xuICAgIGlmKExvZ2luU2VydmljZS5sb2dpbigpKSB7XG4gICAgICB0aGlzLmVycm9ycy5sb2dpbiA9IGZhbHNlXG4gICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5lcnJvcnMubG9naW4gPSB0cnVlXG4gICAgfVxuICB9KTtcbn0pOyIsIi8vIG5hdiBjb250cm9sbGVyXG4ndXNlIHN0cmljdCc7XG5cbnBhcmtpbmcuY29udHJvbGxlcignbmF2Q3RybCcsIGZ1bmN0aW9uIChMb2dpblNlcnZpY2UsICRjb29raWVzKSB7XG4gIHRoaXMubWV0aG9kcyA9IHt9O1xuICB0aGlzLiRjb29raWVzID0gJGNvb2tpZXM7XG4gIHRoaXMuTG9naW5TZXJ2aWNlID0gTG9naW5TZXJ2aWNlO1xuXG4gIC8qKlxuICAgKiBDYWxscyBsb2dvdXQgc2VydmljZVxuICAgKi9cbiAgdGhpcy5tZXRob2RzLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcbiAgICBMb2dpblNlcnZpY2UubG9nb3V0KCk7XG4gIH07XG59KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=